var XiaoSuActivity=function(exports){"use strict";const XSActivity_VERSION="v0.1.5",DEBUG=!0;function getDefaultExportFromCjs(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var bcmodsdk={};!function(exports){!function(){const e="1.1.0";function o(e){alert("Mod ERROR:\n"+e);const o=new Error(e);throw console.error(o),o}const t=new TextEncoder;function n(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function r(e){const o=new Set;return e.filter((e=>!o.has(e)&&o.add(e)))}const i=new Map,a=new Set;function d(e){a.has(e)||(a.add(e),console.warn(e))}function s(e){const o=[],t=new Map,n=new Set;for(const r of p.values()){const i=r.patching.get(e.name);if(i){o.push(...i.hooks);for(const[o,a]of i.patches.entries())t.has(o)&&t.get(o)!==a&&d(`ModSDK: Mod '${r.name}' is patching function ${e.name} with same pattern that is already applied by different mod, but with different pattern:\nPattern:\n${o}\nPatch1:\n${t.get(o)||""}\nPatch2:\n${a}`),t.set(o,a),n.add(r.name)}}o.sort(((e,o)=>o.priority-e.priority));const r=function(e,o){if(0===o.size)return e;let t=e.toString().replaceAll("\r\n","\n");for(const[n,r]of o.entries())t.includes(n)||d(`ModSDK: Patching ${e.name}: Patch ${n} not applied`),t=t.replaceAll(n,r);return(0,eval)(`(${t})`)}(e.original,t);let i=function(o){var t,i;const a=null===(i=(t=m.errorReporterHooks).hookChainExit)||void 0===i?void 0:i.call(t,e.name,n),d=r.apply(this,o);return null==a||a(),d};for(let t=o.length-1;t>=0;t--){const n=o[t],r=i;i=function(o){var t,i;const a=null===(i=(t=m.errorReporterHooks).hookEnter)||void 0===i?void 0:i.call(t,e.name,n.mod),d=n.hook.apply(this,[o,e=>{if(1!==arguments.length||!Array.isArray(o))throw new Error(`Mod ${n.mod} failed to call next hook: Expected args to be array, got ${typeof e}`);return r.call(this,e)}]);return null==a||a(),d}}return{hooks:o,patches:t,patchesSources:n,enter:i,final:r}}function c(e,o=!1){let r=i.get(e);if(r)o&&(r.precomputed=s(r));else{let o=window;const a=e.split(".");for(let t=0;t<a.length-1;t++)if(o=o[a[t]],!n(o))throw new Error(`ModSDK: Function ${e} to be patched not found; ${a.slice(0,t+1).join(".")} is not object`);const d=o[a[a.length-1]];if("function"!=typeof d)throw new Error(`ModSDK: Function ${e} to be patched not found`);const c=function(e){let o=-1;for(const n of t.encode(e)){let e=255&(o^n);for(let o=0;o<8;o++)e=1&e?-306674912^e>>>1:e>>>1;o=o>>>8^e}return((-1^o)>>>0).toString(16).padStart(8,"0").toUpperCase()}(d.toString().replaceAll("\r\n","\n")),l={name:e,original:d,originalHash:c};r=Object.assign(Object.assign({},l),{precomputed:s(l),router:()=>{},context:o,contextProperty:a[a.length-1]}),r.router=function(e){return function(...o){return e.precomputed.enter.apply(this,[o])}}(r),i.set(e,r),o[r.contextProperty]=r.router}return r}function l(){const e=new Set;for(const o of p.values())for(const t of o.patching.keys())e.add(t);for(const o of i.keys())e.add(o);for(const o of e)c(o,!0)}function f(){const e=new Map;for(const[o,t]of i)e.set(o,{name:o,original:t.original,originalHash:t.originalHash,sdkEntrypoint:t.router,currentEntrypoint:t.context[t.contextProperty],hookedByMods:r(t.precomputed.hooks.map((e=>e.mod))),patchedByMods:Array.from(t.precomputed.patchesSources)});return e}const p=new Map;function u(e){p.get(e.name)!==e&&o(`Failed to unload mod '${e.name}': Not registered`),p.delete(e.name),e.loaded=!1,l()}function g(e,t,r){"string"==typeof e&&"string"==typeof t&&(alert(`Mod SDK warning: Mod '${e}' is registering in a deprecated way.\nIt will work for now, but please inform author to update.`),e={name:e,fullName:e,version:t},t={allowReplace:!0===r}),e&&"object"==typeof e||o("Failed to register mod: Expected info object, got "+typeof e),"string"==typeof e.name&&e.name||o("Failed to register mod: Expected name to be non-empty string, got "+typeof e.name);let i=`'${e.name}'`;"string"==typeof e.fullName&&e.fullName||o(`Failed to register mod ${i}: Expected fullName to be non-empty string, got ${typeof e.fullName}`),i=`'${e.fullName} (${e.name})'`,"string"!=typeof e.version&&o(`Failed to register mod ${i}: Expected version to be string, got ${typeof e.version}`),e.repository||(e.repository=void 0),void 0!==e.repository&&"string"!=typeof e.repository&&o(`Failed to register mod ${i}: Expected repository to be undefined or string, got ${typeof e.version}`),null==t&&(t={}),t&&"object"==typeof t||o(`Failed to register mod ${i}: Expected options to be undefined or object, got ${typeof t}`);const a=!0===t.allowReplace,d=p.get(e.name);d&&(d.allowReplace&&a||o(`Refusing to load mod ${i}: it is already loaded and doesn't allow being replaced.\nWas the mod loaded multiple times?`),u(d));const s=e=>{"string"==typeof e&&e||o(`Mod ${i} failed to patch a function: Expected function name string, got ${typeof e}`);let t=g.patching.get(e);return t||(t={hooks:[],patches:new Map},g.patching.set(e,t)),t},f={unload:()=>u(g),hookFunction:(e,t,n)=>{g.loaded||o(`Mod ${i} attempted to call SDK function after being unloaded`);const r=s(e);"number"!=typeof t&&o(`Mod ${i} failed to hook function '${e}': Expected priority number, got ${typeof t}`),"function"!=typeof n&&o(`Mod ${i} failed to hook function '${e}': Expected hook function, got ${typeof n}`);const a={mod:g.name,priority:t,hook:n};return r.hooks.push(a),l(),()=>{const e=r.hooks.indexOf(a);e>=0&&(r.hooks.splice(e,1),l())}},patchFunction:(e,t)=>{g.loaded||o(`Mod ${i} attempted to call SDK function after being unloaded`);const r=s(e);n(t)||o(`Mod ${i} failed to patch function '${e}': Expected patches object, got ${typeof t}`);for(const[n,a]of Object.entries(t))"string"==typeof a?r.patches.set(n,a):null===a?r.patches.delete(n):o(`Mod ${i} failed to patch function '${e}': Invalid format of patch '${n}'`);l()},removePatches:e=>{g.loaded||o(`Mod ${i} attempted to call SDK function after being unloaded`),s(e).patches.clear(),l()},callOriginal:(e,t,n)=>(g.loaded||o(`Mod ${i} attempted to call SDK function after being unloaded`),"string"==typeof e&&e||o(`Mod ${i} failed to call a function: Expected function name string, got ${typeof e}`),Array.isArray(t)||o(`Mod ${i} failed to call a function: Expected args array, got ${typeof t}`),function(e,o,t=window){return c(e).original.apply(t,o)}(e,t,n)),getOriginalHash:e=>("string"==typeof e&&e||o(`Mod ${i} failed to get hash: Expected function name string, got ${typeof e}`),c(e).originalHash)},g={name:e.name,fullName:e.fullName,version:e.version,repository:e.repository,allowReplace:a,api:f,loaded:!0,patching:new Map};return p.set(e.name,g),Object.freeze(f)}function h(){const e=[];for(const o of p.values())e.push({name:o.name,fullName:o.fullName,version:o.version,repository:o.repository});return e}let m;const y=function(){if(void 0===window.bcModSdk)return window.bcModSdk=function(){const o={version:e,apiVersion:1,registerMod:g,getModsInfo:h,getPatchingInfo:f,errorReporterHooks:Object.seal({hookEnter:null,hookChainExit:null})};return m=o,Object.freeze(o)}();if(n(window.bcModSdk)||o("Failed to init Mod SDK: Name already in use"),1!==window.bcModSdk.apiVersion&&o(`Failed to init Mod SDK: Different version already loaded ('1.1.0' vs '${window.bcModSdk.version}')`),window.bcModSdk.version!==e&&(alert(`Mod SDK warning: Loading different but compatible versions ('1.1.0' vs '${window.bcModSdk.version}')\nOne of mods you are using is using an old version of SDK. It will work for now but please inform author to update`),window.bcModSdk.version.startsWith("1.0.")&&void 0===window.bcModSdk._shim10register)){const e=window.bcModSdk,o=Object.freeze(Object.assign(Object.assign({},e),{registerMod:(o,t,n)=>o&&"object"==typeof o&&"string"==typeof o.name&&"string"==typeof o.version?e.registerMod(o.name,o.version,"object"==typeof t&&!!t&&!0===t.allowReplace):e.registerMod(o,t,n),_shim10register:!0}));window.bcModSdk=o}return window.bcModSdk}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=y}()}(bcmodsdk);var bcModSDKRef=getDefaultExportFromCjs(bcmodsdk);const modules={};var ChangeType;!function(ChangeType){ChangeType[ChangeType.main=0]="main",ChangeType[ChangeType.dev=1]="dev"}(ChangeType||(ChangeType={}));const CHANGELOG=[{version:"0.0.1",description:"Initial release",type:ChangeType.dev,changes:["完成基本框架测试中..."]},{version:"0.0.2",description:"修复",type:ChangeType.dev,changes:["修复若干bug","添加部分动作"]},{version:"0.0.3",description:"修复",type:ChangeType.dev,changes:["修复若干bug","完善框架"]},{version:"0.0.4",description:"终于修复了重复加载的Bug",type:ChangeType.dev,changes:["修复重复加载的BUG!!!!!! O.o","修复若干其他bug","完善框架"]},{version:"0.0.5",description:"优化",type:ChangeType.dev,changes:["优化版本信息显示效果"]},{version:"0.1.0",description:"正式发布!当前功能如下: ",type:ChangeType.main,changes:["使用命令导出当前聊天室聊天记录 支持按时间范围导出 详细请查看 /xsa ","添加9个额外动作."]},{version:"0.1.1",description:"添加了新的动作.",type:ChangeType.main,changes:["添加了额外的17个动作","添加 /xsa act 命令 显示添加的全部动作","完成功能自动口吃处理命令:(` + message) --请输入 /xsa jieba 查看帮助"]},{version:"0.1.2",description:"添加修改边缘逻辑.",type:ChangeType.main,changes:["修复一些bug","修复了若干错别字","修改边缘影响，现在每45秒钟 边缘 ,将提高一层高潮抵抗难度，并且增加0.3~1.3秒的即将到来的高潮的持续时间-最多27秒持续时间，如果失去边缘状态，则同样的时间后失去一层抵抗难度，并且减少0.3~1.3秒高潮持续时间."]},{version:"0.1.3",description:"添加修改边缘逻辑以及高潮效果.添加打断抵抗高潮的瘙痒动作.",type:ChangeType.main,changes:["当角色抵抗高潮时被挠痒，则重新开始抵抗并且增加一层难度","当高潮或抵抗高潮时禁用输入框."," ` 命令修改，现在可以在 ` 后或者 数字后跟一个字母 m ，这将在结巴位置添加呻吟效果."]},{version:"0.1.4",description:"添加颜文字快速发送功能!",type:ChangeType.main,changes:["添加快速发送颜文字的功能，以下为简单介绍，详细介绍请输入:/xsa kaomoji 查看。\n使用=> |+[参数]  打开颜文字选择面板，| 为回车上面的按键，需要用 Shift+\\ 键打出 请输入 |help 查看全部参数","调整忍耐高潮时每1.5秒有30%概率发送忍耐反应","高潮后的高潮抵抗难度只降低一半而非原来的降低为0.","重构注入到动作循环的逻辑","重构模组的初始化与加载逻辑"]},{version:"0.1.5",description:"颜文字发送功能大修!",type:ChangeType.main,changes:["颜文字表情功能大修! 新版使用方法请输入/xsa kaomoji 查看!"]}],bcModSDK=bcModSDKRef.registerMod({name:"XiaoSuActivity",fullName:"XiaoSu's Activity Expand",version:XSActivity_VERSION.startsWith("v")?XSActivity_VERSION.slice(1):XSActivity_VERSION,repository:"https://github.com/iceriny/XiaoSuActivity"});function hookFunction(target,priority,hook){return bcModSDK.hookFunction(target,priority,hook)}function SendActivity(msg,sourceCharacter,targetCharacter){const sourceCharacterObj=ChatRoomCharacter.find((c=>c.MemberNumber==sourceCharacter)),targetCharacterObj=targetCharacter?ChatRoomCharacter.find((c=>c.MemberNumber==targetCharacter)):void 0;if(void 0===sourceCharacterObj&&void 0===targetCharacterObj)return;const sourceCharacterNickname=sourceCharacterObj?CharacterNickname(sourceCharacterObj):"",targetCharacterNickname=targetCharacterObj?CharacterNickname(targetCharacterObj):"",resultDict=[{Tag:"MISSING ACTIVITY DESCRIPTION FOR KEYWORD XSA_ActMessage",Text:msg.replaceAll("{source}",sourceCharacterNickname).replaceAll("{target}",targetCharacterNickname)}];resultDict.push({SourceCharacter:sourceCharacter}),void 0!==targetCharacter&&resultDict.push({TargetCharacter:targetCharacter}),conDebug({type:MSGType.Workflow_Log,name:"SendActivity()",content:{Type:"Activity",Content:"XSA_ActMessage",Dictionary:resultDict,Sender:sourceCharacter}}),ServerSend("ChatRoomChat",{Type:"Activity",Content:"XSA_ActMessage",Dictionary:resultDict,Sender:sourceCharacter})}const PH_s="{source}";var MSGType;function conDebug(msg,color=null,style=null){if(!1===DEBUG)return;const result="string"==typeof msg?{name:"XiaoSuActivity_Debug",type:MSGType.DebugLog,content:msg,time:(new Date).toLocaleString(),ModVersion:XSActivity_VERSION}:{name:msg.name,type:msg.type,content:msg.content,time:(new Date).toLocaleString(),ModVersion:XSActivity_VERSION};style?console.debug("%c小酥的模组信息: ",style,result):(color&&(style=`background-color: ${color}; font-weight: bold;`),console.debug("%c小酥的模组信息: ","background-color: rgba(191, 154, 175, 1); font-weight: bold;",result))}function GetModule(moduleName){return modules[moduleName]}function copyAndDownloadHtmlElement(element,fileName,time_limit=null){const newDoc=document.implementation.createHTMLDocument();if(null===element)return void conDebug("element is null");const copiedElement=element.cloneNode(!0);null!==time_limit&&function(element,time_limit){element.querySelectorAll("[data-time]").forEach((element=>{const dataTimeValue=element.getAttribute("data-time");if(dataTimeValue){const currentTime=new Date(`2000-01-01 ${dataTimeValue}`),minTimeDate=new Date(`2000-01-01 ${time_limit.minTime}`),maxTimeDate=new Date(`2000-01-01 ${time_limit.maxTime}`);maxTimeDate<minTimeDate&&maxTimeDate.setDate(maxTimeDate.getDate()+1),(currentTime<minTimeDate||currentTime>maxTimeDate)&&element.remove()}}))}(copiedElement,time_limit),function(element){const style=element.style;for(;style.length>0;)style.removeProperty(style[0])}(copiedElement),copiedElement.style.fontSize="14.784px",copiedElement.style.fontFamily="Arial, sans-serif",copiedElement.style.display="flex",copiedElement.style.flexDirection="column",copiedElement.style.width="70vw",newDoc.body.style.display="flex",newDoc.body.style.alignItems="center",newDoc.body.style.justifyContent="center",newDoc.body.style.backgroundColor="#f2f2f2",newDoc.body.appendChild(copiedElement);const htmlString=newDoc.documentElement.outerHTML,blob=new Blob([htmlString],{type:"text/html"}),link=document.createElement("a");link.href=URL.createObjectURL(blob),link.download=fileName,link.click()}!function(MSGType){MSGType[MSGType.DebugLog=0]="DebugLog",MSGType[MSGType.Workflow_Log=1]="Workflow_Log"}(MSGType||(MSGType={}));class BaseModule{constructor(){this.moduleName="Base",this.priority=0,this.Loaded=!1}}const selfPlaceholder="SourceCharacter";class ActivityModule extends BaseModule{constructor(){super(...arguments),this.activityToAddDict={"XSAct_眯眼":{act:{Name:"XSAct_眯眼",Target:[""],TargetSelf:["ItemHead"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,descString:["",`${selfPlaceholder}眯了眯眼.`],img:"RestHead"},"XSAct_眼神飘忽":{act:{Name:"XSAct_眼神飘忽",Target:[""],TargetSelf:["ItemHead"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,descString:["",`${selfPlaceholder}眼神飘忽的左看右看.`],img:"RestHead"},"XSAct_甩头发":{act:{Name:"XSAct_甩头发",Target:[""],TargetSelf:["ItemHood"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["ItemHoodCovered"]},desc:null,descString:["",`${selfPlaceholder}甩动着头发.`],img:"RestHead"},"XSAct_大力甩头发":{act:{Name:"XSAct_大力甩头发",Target:[""],TargetSelf:["ItemHood"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["ItemHoodCovered"]},desc:null,descString:["",`${selfPlaceholder}连连摇头，慌乱的甩动着头发.`],img:"RestHead"},"XSAct_轻抚发梢":{act:{Name:"XSAct_轻抚发梢",Target:["ItemHood"],TargetSelf:["ItemHood"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["ItemHoodCovered","TargetItemHoodCovered","UseArms"]},desc:null,descString:[`${selfPlaceholder}轻柔抚动着TargetCharacter的头发.`,`${selfPlaceholder}轻柔抚动着自己的头发.`],img:"RestHead"},"XSAct_叼起头发":{act:{Name:"XSAct_叼起头发",Target:["ItemHood"],TargetSelf:["ItemHood"],MaxProgress:50,MaxProgressSelf:20,Prerequisite:["UseMouth","ItemHoodCovered","TargetItemHoodCovered"],StimulationAction:"Talk"},desc:null,descString:[`${selfPlaceholder}轻轻咬起TargetCharacter的头发.`,`${selfPlaceholder}轻轻咬起自己的头发.`],img:"SiblingsCheekKiss"},"XSAct_嗅头发":{act:{Name:"XSAct_嗅头发",Target:["ItemHood"],TargetSelf:["ItemHood"],MaxProgress:30,MaxProgressSelf:30,Prerequisite:["ItemHoodCovered","TargetItemHoodCovered","ItemNoseCovered"],StimulationAction:"Talk"},desc:null,descString:[`${selfPlaceholder}在TargetCharacter的发间嗅着，鼻息弥漫着TargetCharacter的发香.`,`${selfPlaceholder}撩起自己的头发轻轻嗅着.`],img:"SiblingsCheekKiss"},"XSAct_绕头发":{act:{Name:"XSAct_绕头发",Target:["ItemHood"],TargetSelf:["ItemHood"],MaxProgress:30,MaxProgressSelf:30,Prerequisite:["UseArms","ItemHoodCovered","TargetItemHoodCovered"]},desc:null,descString:[`${selfPlaceholder}勾起一缕TargetCharacter的发丝，在指尖绕来绕去.`,`${selfPlaceholder}勾起自己的一缕头发在指尖绕来绕去.`],img:"SiblingsCheekKiss"},"XSAct_皱鼻子":{act:{Name:"XSAct_皱鼻子",Target:[""],TargetSelf:["ItemNose"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["ItemHoodCovered","ItemNoseCovered"]},desc:null,descString:["",`${selfPlaceholder}皱了皱自己的鼻头.`],img:"RestHead"},"XSAct_打喷嚏":{act:{Name:"XSAct_打喷嚏",Target:[""],TargetSelf:["ItemNose"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["UseMouth","ItemHoodCovered"],StimulationAction:"Talk"},desc:null,descString:["",`${selfPlaceholder}打了个喷嚏.`],img:"Kiss"},"XSAct_深呼吸":{act:{Name:"XSAct_深呼吸",Target:[""],TargetSelf:["ItemNose"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["UseMouth","ItemHoodCovered","ItemNoseCovered"],StimulationAction:"Talk"},desc:null,descString:["",`${selfPlaceholder}深深的吸了口气.`],img:"Kiss"},"XSAct_低头":{act:{Name:"XSAct_低头",Target:[""],TargetSelf:["ItemHood"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["ItemHoodCovered","MoveHead"]},desc:null,descString:["",`${selfPlaceholder}红润着脸蛋低头逃避.`],img:"RestHead"},"XSAct_恳求的摇头":{act:{Name:"XSAct_恳求的摇头",Target:["ItemHead"],TargetSelf:[""],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["MoveHead"]},desc:null,descString:[`${selfPlaceholder}对着TargetCharacter的方向恳求的摇头.`,""],img:"RestHead"},"XSAct_恳求的看":{act:{Name:"XSAct_恳求的看",Target:["ItemHead"],TargetSelf:[""],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["TargetZoneNaked","MoveHead"]},desc:null,descString:[`${selfPlaceholder}汪着眼睛恳求的看着TargetCharacter.`,""],img:"RestHead"},"XSAct_内八夹腿":{act:{Name:"XSAct_内八夹腿",Target:[""],TargetSelf:["ItemLegs"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,descString:["",`${selfPlaceholder}通红的脸蛋忍耐着快感，大腿紧紧夹起来，摆出着内八的姿势，身体微微颤抖.`],img:"Kick"},"XSAct_噘嘴":{act:{Name:"XSAct_噘嘴",Target:[""],TargetSelf:["ItemMouth","ItemMouth2","ItemMouth3"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["UseMouth"]},desc:null,descString:["",`${selfPlaceholder}有些不满的噘起嘴巴.`],img:"PoliteKiss"},"XSAct_抿住嘴巴":{act:{Name:"XSAct_抿住嘴巴",Target:[""],TargetSelf:["ItemMouth","ItemMouth2","ItemMouth3"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["UseMouth"]},desc:null,descString:["",`${selfPlaceholder}抿住嘴巴.`],img:"PoliteKiss"},"XSAct_瘪嘴":{act:{Name:"XSAct_瘪嘴",Target:[""],TargetSelf:["ItemMouth","ItemMouth2","ItemMouth3"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["UseMouth"]},desc:null,descString:["",`${selfPlaceholder}瘪着嘴巴，一副委屈的样子.`],img:"PoliteKiss"},"XSAct_坐直身体":{act:{Name:"XSAct_坐直身体",Target:[""],TargetSelf:["ItemTorso","ItemTorso2"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,descString:["",`${selfPlaceholder}挺直了腰，坐直了身体.`],img:"Kick"},"XSAct_挺胸收腹":{act:{Name:"XSAct_挺胸收腹",Target:[""],TargetSelf:["ItemBreast"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,descString:["",`${selfPlaceholder}挺起胸部，微收下巴，腹部用力收腰.`],img:"Kick"},"XSAct_站直身体":{act:{Name:"XSAct_站直身体",Target:[""],TargetSelf:["ItemTorso","ItemTorso2"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["NotKneeling"]},desc:null,descString:["",`${selfPlaceholder}挺胸收腹，努力绷紧小腿，站直了身体.`],img:"Kick"},"XSAct_身体一颤":{act:{Name:"XSAct_身体一颤",Target:[""],TargetSelf:["ItemTorso","ItemTorso2"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,descString:["",`${selfPlaceholder}的身体猛然颤抖了一下.`],img:"Kick"},"XSAct_活动大腿":{act:{Name:"XSAct_活动大腿",Target:[""],TargetSelf:["ItemLegs"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,descString:["",`${selfPlaceholder}尝试活动了一下腿部.`],img:"Kick"},"XSAct_活动手臂":{act:{Name:"XSAct_活动手臂",Target:[""],TargetSelf:["ItemArms"],MaxProgress:30,MaxProgressSelf:30,Prerequisite:["CantUseArms"]},desc:null,descString:["",`${selfPlaceholder}一边按摩一边活动着手臂.`],img:"MasturbateHand"},"XSAct_绷紧膝盖":{act:{Name:"XSAct_绷紧膝盖",Target:[""],TargetSelf:["ItemLegs"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["NotKneeling"]},desc:null,descString:["",`${selfPlaceholder}努力的绷紧膝盖，尽可能站的更直.`],img:"Kick"},"XSAct_绷直脚踝":{act:{Name:"XSAct_绷直脚踝",Target:[""],TargetSelf:["ItemBoots"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,descString:["",`${selfPlaceholder}不自觉的用力绷直脚踝，释放涌来的快感.`],img:"Kick"},"XSAct_蜷缩脚趾":{act:{Name:"XSAct_蜷缩脚趾",Target:[""],TargetSelf:["ItemBoots"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,descString:["",`${selfPlaceholder}脚趾互相纠结，又时而蜷缩，忍耐着快感袭来.`],img:"Kick"},"XSAct_踮脚":{act:{Name:"XSAct_踮脚",Target:[""],TargetSelf:["ItemBoots"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["CantUseFeet"]},desc:null,descString:["",`${selfPlaceholder}努力的踮起脚.`],img:"Kick"}},this.prerequisiteDict={ItemHoodCovered:{Name:"ItemHoodCovered",Action:args=>{const acting=args[1];return this.Judgment.ItemHoodCovered(acting)}},TargetItemHoodCovered:{Name:"TargetItemHoodCovered",Action:args=>{const acted=args[2];return this.Judgment.ItemHoodCovered(acted)}},ItemNoseCovered:{Name:"ItemNoseCovered",Action:args=>{const acting=args[1];return this.Judgment.ItemNoseCovered(acting)}},Kneeling:{Name:"Kneeling",Action:args=>{const acting=args[1];return this.Judgment.Kneeling(acting)}},NotKneeling:{Name:"NotKneeling",Action:args=>{const acting=args[1];return this.Judgment.NotKneeling(acting)}}},this.Judgment={ItemHoodCovered:acting=>""===InventoryPrerequisiteMessage(acting,"HoodEmpty"),ItemNoseCovered:acting=>""==(InventoryGet(acting,"NoseEmpty")?"CannotBeUsedOverMask":""),Kneeling:acting=>acting.IsKneeling(),NotKneeling:acting=>!acting.IsKneeling()}}Init(){this.moduleName="ActivityModule",this.priority=50}Load(){this.LoadActivity(),this.hookListHandler(),this.Loaded=!0}hookListHandler(){hookFunction("ServerSend",5,((args,next)=>{var _a,_b,_c;if("ChatRoomChat"==args[0]&&"Activity"==(null===(_a=args[1])||void 0===_a?void 0:_a.Type)){const data=args[1];if(0==(null!==(_c=null===(_b=data.Dictionary[3])||void 0===_b?void 0:_b.ActivityName)&&void 0!==_c?_c:"").indexOf("XSAct_")){const{substitutions:substitutions}=ChatRoomMessageRunExtractors(data,Player);let msg=ActivityDictionaryText(data.Content);msg=CommonStringSubstitute(msg,null!=substitutions?substitutions:[]),data.Dictionary.push({Tag:"MISSING ACTIVITY DESCRIPTION FOR KEYWORD "+data.Content,Text:msg})}}return next(args)})),hookFunction("ActivityCheckPrerequisite",500,((args,next)=>{const prereq=args[0];if(prereq in this.prerequisiteDict){return this.prerequisiteDict[prereq].Action(args)}return next(args)})),hookFunction("DrawImageResize",10,((args,next)=>{const source=args[0];if("string"!=typeof source)return next(args);const parts=source.split("/"),aName=parts[parts.length-1].replace(".png","");if(0==aName.indexOf("XSAct_")){const resultName=`Assets/Female3DCG/Activity/${this.activityToAddDict[aName].img}.png`;return args[0]=resultName,next(args)}return next(args)})),hookFunction("ChatRoomMessage",this.priority,((args,next)=>{var _a,_b,_c,_d,_e,_f;const data=args[0];if(conDebug({name:"ChatRoomMessage",type:MSGType.DebugLog,content:data}),"Activity"==data.Type){const actName=null===(_a=data.Dictionary[3])||void 0===_a?void 0:_a.ActivityName,SourceCharacter=null===(_b=data.Dictionary[0])||void 0===_b?void 0:_b.SourceCharacter,TargetCharacter=null===(_c=data.Dictionary[1])||void 0===_c?void 0:_c.TargetCharacter;"Tickle"!=actName||Number.isNaN(TargetCharacter)||TargetCharacter!=(null===Player||void 0===Player?void 0:Player.MemberNumber)||(conDebug({type:MSGType.DebugLog,name:"检测到自己为目标的瘙痒动作",content:{"高潮阶段":null===(_d=Player.ArousalSettings)||void 0===_d?void 0:_d.OrgasmStage,"抵抗难度":ActivityOrgasmGameResistCount}}),1==(null===(_e=Player.ArousalSettings)||void 0===_e?void 0:_e.OrgasmStage)&&(conDebug({type:MSGType.DebugLog,name:"捕捉到抵抗场景，开始截断抵抗 增加难度 并重新触发",content:{"高潮阶段":null===(_f=Player.ArousalSettings)||void 0===_f?void 0:_f.OrgasmStage,"抵抗难度":ActivityOrgasmGameResistCount}}),ActivityOrgasmGameResistCount++,SendActivity("{target}紧闭双眼尽力抵抗着高潮，但被{source}的瘙痒干扰，从嘴巴里泄露出一声压抑的呻吟，不知是否还能忍住.",SourceCharacter,TargetCharacter),ActivityOrgasmStop(Player,99.5),ActivityOrgasmPrepare(Player)))}return next(args)}))}LoadActivity(){conDebug("加载自定义活动");let actLength=0;for(const aN in this.activityToAddDict){this.pushToActivity(this.activityToAddDict[aN].act),this.activityDictAdd();const activityDesc=this.activityToAddDict[aN].desc;null==activityDesc||activityDesc.forEach((d=>{null===ActivityDictionary||void 0===ActivityDictionary||ActivityDictionary.push(d)})),actLength+=1}conDebug(`自定义活动加载完成.动作数: ${actLength}`)}activityDictAdd(){for(const a in this.activityToAddDict){const pendingActivity=this.activityToAddDict[a],actName=pendingActivity.act.Name,nameWithoutPrefix=actName.substring(6),actTarget=pendingActivity.act.Target,actTargetSelf=pendingActivity.act.TargetSelf,addedValues=[];if(addedValues.push([`ActivityAct_${actName}`,`${nameWithoutPrefix}`]),addedValues.push([`Activity${actName}`,`${nameWithoutPrefix}`]),actTarget.length>0)for(const aT of actTarget)addedValues.push([`Label-ChatOther-${aT}-${actName}`,`${nameWithoutPrefix}`]),addedValues.push([`ChatOther-${aT}-${actName}`,pendingActivity.descString[0]]);if(void 0!==actTargetSelf&&"boolean"!=typeof actTargetSelf&&actTargetSelf.length>0)for(const aTS of actTargetSelf)addedValues.push([`Label-ChatSelf-${aTS}-${actName}`,`${nameWithoutPrefix}`]),addedValues.push([`ChatSelf-${aTS}-${actName}`,pendingActivity.descString[1]]);pendingActivity.desc=addedValues}}pushToActivity(activity){ActivityFemale3DCG.push(activity),ActivityFemale3DCGOrdering.push(activity.Name)}getAllAct(){const result=[];for(const a in this.activityToAddDict){const suffix=a.substring(6);result.push(suffix)}return conDebug({content:result,name:"ActivityNameXiaosu_onlyName",type:MSGType.DebugLog}),result}}const buildKaomojiMenuCSShref=DEBUG?"https://iceriny.github.io/XiaoSuActivity/dev/XSActivityStyle.css":"https://iceriny.github.io/XiaoSuActivity/main/XSActivityStyle.css";class ChatroomModule extends BaseModule{constructor(){super(...arguments),this.moan=[" 嗯~❤.."," 昂~❤哈啊.."," --唔~呜.."," 姆嗯~❤..."," --嘶-啊~"," 唔..❤啊~"," --❤嘶哈~"," ❤呀~"," ❤...呀嗯.."," ❤.哦~嗯~."]}Load(){this.hookListHandler(),this.Loaded=!0}Init(){this.moduleName="ChatroomModule",this.priority=30;const linkElement=document.createElement("link");linkElement.rel="stylesheet",linkElement.type="text/css",linkElement.href=buildKaomojiMenuCSShref,document.head.appendChild(linkElement)}hookListHandler(){hookFunction("ChatRoomLoad",this.priority,((args,next)=>{const result=next(args);return ChatroomModule.InputElement||(ChatroomModule.InputElement=document.getElementById("InputChat")),ChatroomModule.buildKaomojiButton(),result})),hookFunction("ElementPosition",this.priority,((args,next)=>{const result=next(args);return"InputChat"===args[0]&&ChatroomModule.ResizeKaomojiButton(),result})),hookFunction("ElementCreateTextArea",this.priority,((args,next)=>{const result=next(args);return"InputChat"===args[0]&&(ChatroomModule.InputElement=document.getElementById("InputChat")),result})),hookFunction("ChatRoomClearAllElements",this.priority,((args,next)=>(ChatroomModule.removeKaomojiMenu(),ChatroomModule.InputElement=null,next(args)))),hookFunction("ChatRoomShowElements",this.priority,((args,next)=>{const result=next(args);return ChatroomModule.showKaomojiMenu(),result})),hookFunction("ChatRoomHideElements",this.priority,((args,next)=>{const result=next(args);return ChatroomModule.hideKaomojiMenu(),result})),hookFunction("CommandParse",0,((args,next)=>{let msg=args[0];const match=msg.match(/^`([1-9])?(m)?( )? (.*)/);match&&(msg="m"!=match[2]?this.stammerHandler(match[4],parseInt(match[1]),!match[3],!1):this.stammerHandler(match[4],parseInt(match[1]),!match[3],!0));const kaomojiMatch=msg.match(/^\|(.*)/);if(!kaomojiMatch)return args[0]=msg,next(args);if(Object.keys(ChatroomModule.kaomojiSet).includes(kaomojiMatch[1])||"all"==kaomojiMatch[1]){ChatroomModule.kaomojiHandler(kaomojiMatch[1]);document.getElementById("InputChat").value=""}else{ChatRoomSendLocal("该颜文字表情包不存在，请重新输入或输入 |help 查看参数",5e3);document.getElementById("InputChat").value="|"}}))}ExportChat(time_limit=null){const exportName=`${null===ChatRoomData||void 0===ChatRoomData?void 0:ChatRoomData.Name}_${(new Date).toLocaleString()}`;copyAndDownloadHtmlElement(document.getElementById("TextAreaChatLog"),exportName,time_limit)}stammerHandler(content,tenfoldStammeringProbability,isSegmentForCH,haveMoan){conDebug(`stammerHandler: content: ${content} tenfoldStammeringProbability: ${tenfoldStammeringProbability}`),Number.isNaN(tenfoldStammeringProbability)&&(tenfoldStammeringProbability=3);const stammeringProbability=tenfoldStammeringProbability/10,segmentList=isSegmentForCH?function(str){if(conDebug({name:"segmentForCHTest",type:MSGType.DebugLog,content:{Intl:!!window.Intl,Segmenter:!!window.Intl.Segmenter,GAME_LANG:TranslationLanguage.toLowerCase()}}),window.Intl&&window.Intl.Segmenter&&"cn"===TranslationLanguage.toLowerCase()){const segmenterResult=new Intl.Segmenter("zh",{granularity:"word"}).segment(str),results=[];for(const segment of segmenterResult)results.push(segment.segment);return conDebug(`segmentForCH: ${results}`),results}return null}(content.replace(/\s/g,"")):void 0,stringArray=segmentList||content.split(" ");return this.stammerForList(stringArray,stammeringProbability,haveMoan)}stammerForList(messageList,stammeringProbability,haveMoan){var _a,_b;let result="";for(let i=0;i<messageList.length;i++){const currentWord=messageList[i];result+=currentWord,Math.random()<stammeringProbability&&(result+=this.addStammerEffect(currentWord)),haveMoan&&(null===(_a=Player.ArousalSettings)||void 0===_a?void 0:_a.Progress)&&100*Math.random()<=(null===(_b=Player.ArousalSettings)||void 0===_b?void 0:_b.Progress)&&(result+=this.moan[Math.floor(Math.random()*this.moan.length)]),i<messageList.length-1?Math.random()<stammeringProbability&&(result+="-"):result+="..."}return conDebug({name:"stammer",type:MSGType.DebugLog,content:result}),result}addStammerEffect(word,depth=0){if(depth>=3)return word;let result=Math.random()<.5?"...":`-${word}`;return Math.random()<.2&&(result=this.addStammerEffect(result,depth+1)),result}static kaomojiHandler(message){this.getKaomojiMenu(message).style.display="flex",this.KaomojiShouldShow=!0}static buildKaomojiButton(){if(this.KaomojiButton)return this.KaomojiButton;const button=document.createElement("button");return button.id="kaomoji-button",button.className="kaomoji-button",button.type="button",button.addEventListener("click",(()=>{this.KaomojiMenuObject.menu&&"none"!==this.KaomojiMenuObject.menu.style.display?"none"!==this.KaomojiMenuObject.menu.style.display&&(this.KaomojiMenuObject.menu.style.display="none",this.KaomojiShouldShow=!1):this.kaomojiHandler("all")})),this.isKaomojiMenuCloseEventListenerAdded||(document.addEventListener("click",(event=>{const target=event.target;!target.closest("#kaomoji-menu")&&!target.closest("#kaomoji-button")&&this.KaomojiMenuObject.menu&&this.KaomojiShouldShow&&(this.KaomojiMenuObject.menu.style.display="none",this.KaomojiShouldShow=!1)})),this.isKaomojiMenuCloseEventListenerAdded=!0),button.innerHTML=":)",this.ResizeKaomojiButton(),this.KaomojiButton=button,document.body.appendChild(button),button}static ResizeKaomojiButton(){this.InputElement&&this.KaomojiButton&&(this.KaomojiButton.style.top=parseInt(this.InputElement.style.top)-.026*window.innerHeight+"px",this.KaomojiButton.style.left=parseInt(this.InputElement.style.left)-.026*window.innerHeight+"px")}static getKaomojiMenu(key){const{kaomojiContainer:kaomojiContainer,menu:menu}=this.KaomojiMenuObject.menu?{kaomojiContainer:this.KaomojiMenuObject.container,menu:this.KaomojiMenuObject.menu}:ChatroomModule.buildKaomojiMenu();return this.selectKaomojiTitle(kaomojiContainer,key),menu}static kaomojiClick(event,kaomojiElement){if(0===event.button){if(this.InputElement){const cursorPosition=this.InputElement.selectionStart;if(null===cursorPosition||-1==cursorPosition)this.InputElement.value+=kaomojiElement.textContent;else{const value=this.InputElement.value,newValue=value.substring(0,cursorPosition)+kaomojiElement.textContent+value.substring(cursorPosition);this.InputElement.value=newValue;const newCursorPosition=cursorPosition+(null==kaomojiElement.textContent?0:kaomojiElement.textContent.length);this.InputElement.setSelectionRange(newCursorPosition,newCursorPosition)}}}else 2===event.button?null!=(msg=kaomojiElement.textContent)&&ServerSend("ChatRoomChat",{Content:msg,Type:"Emote"}):1===event.button&&function(msg){null!=msg&&ServerSend("ChatRoomChat",{Type:"Chat",Content:msg})}(kaomojiElement.textContent);var msg}static buildKaomojiMenu(){const menu=document.createElement("div");menu.id="kaomoji-menu",menu.style.display="flex";const menuTitle=document.createElement("div"),menuTitleTextSet=this.menuTitleTextSet,menuTitleClose=document.createElement("button");menuTitleClose.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"\n            viewBox="0 0 24 24">\n            <circle cx="12" cy="12" r="10" fill="red" />\n        </svg>';const kaomojiContainer=document.createElement("div");menu.appendChild(menuTitle),menu.appendChild(kaomojiContainer),menu.className="kaomoji-menu",menuTitle.className="kaomoji-title",menuTitleClose.className="kaomoji-title-close",kaomojiContainer.className="kaomoji-container",menuTitleClose.addEventListener("click",(()=>{menu.style.display="none",this.KaomojiShouldShow=!1}));for(const key in menuTitleTextSet)menuTitleTextSet[key].innerHTML=key,menuTitleTextSet[key].className="kaomoji-title-text",menuTitle.appendChild(menuTitleTextSet[key]),menuTitleTextSet[key].addEventListener("click",(()=>{const selectKey=this.getKaomojiSelectKey(key);this.selectKaomojiTitle(kaomojiContainer,selectKey)}));return menuTitle.appendChild(menuTitleClose),this.KaomojiMenuObject={title:menuTitle,container:kaomojiContainer,menu:menu},document.body.appendChild(menu),{kaomojiContainer:kaomojiContainer,menu:menu}}static selectMenuTitleStyleHandle(selectKey){this.menuTitleTextSet[selectKey].classList.contains("kaomoji-title-text-active")||this.menuTitleTextSet[selectKey].classList.add("kaomoji-title-text-active");for(const key2 in this.menuTitleTextSet)key2!=selectKey&&this.menuTitleTextSet[key2].classList.remove("kaomoji-title-text-active")}static getKaomojiSelectKey(key){let selectKey=null;switch(key){case"开心":selectKey="hp";break;case"难过":selectKey="sd";break;case"害羞":selectKey="sy";break;case"生气":selectKey="ar";break;case"惊讶":selectKey="sp";break;case"困惑":selectKey="cf";break;case"搞怪":selectKey="nt";break;default:selectKey="all"}return selectKey}static getKaomojiKey(selectKey){let key=null;switch(selectKey){case"hp":key="开心";break;case"sd":key="难过";break;case"sy":key="害羞";break;case"ar":key="生气";break;case"sp":key="惊讶";break;case"cf":key="困惑";break;case"nt":key="搞怪";break;default:key="全部"}return key}static selectKaomojiTitle(kaomojiContainer,key){const kaomojiList="all"==key?this.getAllKaomoji():this.kaomojiSet[key];kaomojiContainer.innerHTML="";this.selectMenuTitleStyleHandle(this.getKaomojiKey(key));for(const kaomoji of kaomojiList){const kaomojiElement=document.createElement("div");kaomojiElement.className="kaomoji",kaomojiElement.innerText=kaomoji,"help"!==key&&(kaomojiElement.addEventListener("click",(event=>{this.kaomojiClick(event,kaomojiElement)})),kaomojiElement.addEventListener("contextmenu",(event=>{event.preventDefault(),this.kaomojiClick(event,kaomojiElement)})),kaomojiElement.addEventListener("mousedown",(event=>{1===event.button&&(event.preventDefault(),this.kaomojiClick(event,kaomojiElement))}))),kaomojiContainer.appendChild(kaomojiElement)}}static removeKaomojiMenu(){this.KaomojiButton&&(this.KaomojiButton.remove(),this.KaomojiButton=null),this.KaomojiMenuObject.menu&&(this.KaomojiMenuObject.menu.remove(),this.KaomojiMenuObject={menu:null,title:null,container:null})}static hideKaomojiMenu(){this.KaomojiMenuObject.menu&&(this.KaomojiMenuObject.menu.style.display="none"),this.KaomojiButton&&(this.KaomojiButton.style.display="none")}static showKaomojiMenu(){this.KaomojiMenuObject.menu&&1==this.KaomojiShouldShow&&(this.KaomojiMenuObject.menu.style.display="flex"),this.KaomojiButton&&(this.KaomojiButton.style.display="inline")}static getAllKaomoji(){const allKaomojiList=[];for(const key in this.kaomojiSet)if("help"!=key)for(const kaomoji of this.kaomojiSet[key])allKaomojiList.push(kaomoji);return allKaomojiList}}var _a$2;ChatroomModule.InputElement=null,ChatroomModule.KaomojiMenuObject={menu:null,title:null,container:null},ChatroomModule.menuTitleTextSet={"全部":document.createElement("div"),"开心":document.createElement("div"),"难过":document.createElement("div"),"害羞":document.createElement("div"),"生气":document.createElement("div"),"惊讶":document.createElement("div"),"困惑":document.createElement("div"),"搞怪":document.createElement("div")},ChatroomModule.KaomojiButton=null,ChatroomModule.KaomojiShouldShow=!1,ChatroomModule.kaomojiSet={help:["all ==> 全部表情","hp ==> 开心","sd ==> 伤心","sy ==> 害羞","ar ==> 生气","ap ==> 惊讶","cf ==> 困惑","nt ==> 搞怪顽皮"],hp:["ヾ(❀╹◡╹)ﾉ~"," (๑>؂<๑）","(｡･ω･｡)ﾉ♡","(◍ ´꒳` ◍)","(￣w￣)ノ","Hi~ o(*￣▽￣*)ブ","(≧∇≦)ﾉ","o(^▽^)o","(￣︶￣)↗","<(￣︶￣)↗[GO!]","o(*￣▽￣*)o","(p≧w≦q)","ㄟ(≧◇≦)ㄏ","(/≧▽≦)/","(　ﾟ∀ﾟ) ﾉ♡","(●'◡'●)","ヽ(✿ﾟ▽ﾟ)ノ","o(*￣︶￣*)o","(๑¯∀¯๑)","(≧∀≦)ゞ","φ(≧ω≦*)♪","╰(*°▽°*)╯","(*^▽^*)","(๑•̀ㅂ•́)و✧","(੭*ˊᵕˋ)੭*ଘ*","(o゜▽゜)o☆[BINGO!]","(^▽^ )","<(*￣▽￣*)/","┌|*´∀｀|┘","♪(´∇`*)","(｡◕ฺˇε ˇ◕ฺ｡）"," ✌︎( ᐛ )✌︎","(*・ω・)ﾉ","(„• ֊ •„)"],sd:["テ_デ","□_□","┭┮﹏┭┮","╥﹏╥...","o(TヘTo)","〒▽〒","ε(┬┬﹏┬┬)3","(;´༎ຶД༎ຶ`)","(ノへ`、)","（-_-。）","(ノへ￣、)","｡◔‸◔｡","(⊙﹏⊙)"],sy:["|ω・）","|･ω･｀)","◕ฺ‿◕ฺ✿ฺ)","つ﹏⊂","(* /ω＼*)","o(*////▽////*)q","(*/ω＼*)","(′▽`〃)","(✿◡‿◡)","(/▽＼)","(๑´ㅂ`๑)","(◡ᴗ◡✿)","⁄(⁄ ⁄•⁄ω⁄•⁄ ⁄)⁄","(〃'▽'〃)","(๑╹ヮ╹๑)ﾉ"],ar:["/ᐠ｡ꞈ｡ᐟ\\","˃ʍ˂","(σ｀д′)σ","＼(゜ロ＼)(／ロ゜)／","<(－︿－)>","(ー`´ー)","（｀へ´）","(-__-)=@))> o<)","(///￣皿￣)○～","┻━┻︵╰(‵□′)╯︵┻━┻","→)╥﹏╥)","抽!!(￣ε(#￣)☆╰╮(￣▽￣///)","(￣ε(#￣)☆╰╮o(￣皿￣///)","(* ￣︿￣)","（＃￣～￣＃）","(⊙x⊙;)","o(*≧▽≦)ツ┏━┓","(ノω<。)ノ))☆.。","(〃＞目＜)","( σ'ω')σ","o(′益`)o","(〃＞目＜)","o(≧口≦)o","Ｏ(≧口≦)Ｏ","...(*￣０￣)ノ[等等我…]","（≧0≦）","ψ(*｀ー´)ψ","ψ(￣皿￣)ノ"],sp:["✧∇✧","!!!∑(ﾟДﾟノ)ノ","’(°ー°〃)","ヾ(ノ' ﹃' )ノ","(ーー゛)","(○´･д･)ﾉ","wow~ ⊙o⊙","~(￣0￣)/","Σ(｀д′*ノ)ノ","Σ(っ °Д °;)っ","(⊙ˍ⊙)","w(ﾟДﾟ)w","ｍ(o・ω・o)ｍ","⊙▽⊙","（இ௰இ）","(●°u°●)​ 」","（｡ò ∀ ó｡）","(๑•̀ω•́)ノ"],cf:["⚆_⚆","( -'`-)","(=′ー`)","( -'`-; )","(・-・*)","( ｀д′)","(￣m￣）","( ╯▽╰)"," o-o(=•ェ•=)m","(⊙﹏⊙)","Σ( ° △ °|||)︴","(⊙ˍ⊙)","( ᗜ ˰ ᗜ )","꒰ ˶• ༝ •˶꒱"],nt:["(ˉ▽￣～) 切~~","(￣w￣)ノ","(￣v￣)ノ","(￣l￣)ノ","( ￣ー￣)","(‾◡◝)","(￣_,￣ )","( ﹁ ﹁ ) ~→","<(￣ ﹌ ￣)@m","ꉂ-ꉂ(ˊᗜˋ*)","(｀・ω・´）","༼ つ ◕_◕ ༽つ","ヽ(✿ﾟ▽ﾟ)ノ (°ー°〃)","ヾ(￣▽￣)Bye~Bye~","(◉ω◉υ)⁼³₌₃","(●—●)","(｡･∀･)ﾉﾞ","┬─┬ ノ('-'ノ)","┸━━┸)>口<)","(-.-)..zzZZ","(｡◝ᴗ◜｡)"," =͟͟͞͞(꒪ᗜ꒪ ‧̣̥̇)","(˵¯͒〰¯͒˵)"]},ChatroomModule.isKaomojiMenuCloseEventListenerAdded=!1;const PlayerStorage=()=>Player.XSA,ExtensionStorage=()=>Player.ExtensionSettings.XSA;class DataModule extends BaseModule{Load(){this.hookListHandle(),_a$2.allDataTake(),this.Loaded=!0}Init(){this.moduleName="DataModule",this.priority=0,window.BROWSER_NAME=_a$2.browserName,window.BROWSER_VERSION=_a$2.browserVersion}hookListHandle(){hookFunction("ChatRoomLeave",this.priority,((args,next)=>(_a$2.allDataSave(),next(args)))),hookFunction("ChatRoomSync",this.priority,((args,next)=>(_a$2.allDataSave(),next(args))))}static allDataTake(){var _b;ExtensionStorage()?Player.XSA=JSON.parse(null!==(_b=LZString.decompressFromBase64(ExtensionStorage()))&&void 0!==_b?_b:""):Player.XSA={version:XSActivity_VERSION,data:this.DefaultData,settings:this.DefaultSetting}}static allDataSave(){var _b,_c,_d,_e,_f,_g;ExtensionStorage()||(Player.ExtensionSettings.XSA="");const data={version:null!==(_c=null===(_b=PlayerStorage())||void 0===_b?void 0:_b.version)&&void 0!==_c?_c:XSActivity_VERSION,settings:null!==(_e=null===(_d=PlayerStorage())||void 0===_d?void 0:_d.settings)&&void 0!==_e?_e:{},data:null!==(_g=null===(_f=PlayerStorage())||void 0===_f?void 0:_f.data)&&void 0!==_g?_g:{}};Player.ExtensionSettings.XSA=LZString.compressToBase64(JSON.stringify(data)),ServerPlayerExtensionSettingsSync("XSA")}static SaveSettings(settingsItem){var _b;const settingsData=null===(_b=PlayerStorage())||void 0===_b?void 0:_b.settings;for(const item in settingsItem)settingsData&&settingsData[item]!=settingsItem[item]&&(settingsData[item]=settingsItem[item])}static SaveData(dataItem){var _b;const data=null===(_b=PlayerStorage())||void 0===_b?void 0:_b.data;for(const item in dataItem)data&&data[item]!=dataItem[item]&&(data[item]=dataItem[item])}}_a$2=DataModule,DataModule.userAgentString=navigator.userAgent,DataModule.browserVersionRegex=/(chrome|firefox|safari|opera|edge|msie|trident(?=\/))\/?\s*(\d+)/i,DataModule.match=_a$2.userAgentString.match(_a$2.browserVersionRegex),DataModule.DefaultData={haveWombTattoos:!1,WombTattoosAppliedEffects:[],sensitiveLevel:0},DataModule.DefaultSetting={},DataModule.browserName=_a$2.match?_a$2.match[1]:"unknown",DataModule.browserVersion=_a$2.match?parseInt(_a$2.match[2]):-1;class TimerProcessInjector extends BaseModule{static set setProcessInjectionSequence(sequence){for(const c of sequence)this.processInjectionSet[c.name]=c}Load(){TimerProcessInjector.ProcessInjection(),this.Loaded=!0}Init(){this.moduleName="TimerProcessInjector",this.priority=999}static ProcessInjection(){TimerProcessInjector.InjectionSort();for(const c of this.processInjectionSequence)this.TimerLastCycleCallSet[c.name]=-1;conDebug(`[TimerProcessInjector] Injection Process... Injection Count: ${this.processInjectionSequence.length}`),hookFunction("TimerProcess",100,((args,next)=>{const currentTime=CommonTime();for(const c of this.processInjectionSequence)-1==this.TimerLastCycleCallSet[c.name]&&this.TimerLastCycleCallSet[c.name],c.preconditions()&&this.TimerLastCycleCallSet[c.name]+c.timeInterval<=currentTime&&(c.code(),this.TimerLastCycleCallSet[c.name]=currentTime);return next(args)}))}static InjectionSort(){this.processInjectionSequence=Object.values(this.processInjectionSet).sort(((a,b)=>a.priority-b.priority))}}var _a$1;TimerProcessInjector.processInjectionSequence=[],TimerProcessInjector.processInjectionSet={},TimerProcessInjector.TimerLastCycleCallSet={};class WombTattoosModule extends BaseModule{Init(){this.moduleName="WombTattoosModule",this.priority=100,TimerProcessInjector.setProcessInjectionSequence=[{name:"WombTattoosCheck",priority:10,preconditions:()=>_a$1.checkPlayerHaveWombTattoos()&&_a$1.isCheckWombTattoosEffect,timeInterval:1e3,code:()=>{_a$1.isCheckWombTattoosEffect=!1;const wombTattoosAppliedLayerNames=_a$1.getAppliedLayerNames(Player),E=_a$1.wombTattoosEffects,appliedEffects=[];for(const e in E){const effect=E[e],name=effect.name;effect.layers.every((l=>wombTattoosAppliedLayerNames.includes(l)))&&appliedEffects.push(name)}DataModule.SaveData({WombTattoosAppliedEffects:appliedEffects,sensitiveLevel:appliedEffects.length})}},{name:"HaveWombTattoosEffectsHandle",priority:11,timeInterval:200,preconditions:()=>{var _b,_c,_d,_e,_f,_g,_h;return null!==(_d=null===(_c=null===(_b=PlayerStorage())||void 0===_b?void 0:_b.data)||void 0===_c?void 0:_c.haveWombTattoos)&&void 0!==_d&&_d&&(null!==(_h=null===(_g=null===(_f=null===(_e=PlayerStorage())||void 0===_e?void 0:_e.data)||void 0===_f?void 0:_f.WombTattoosAppliedEffects)||void 0===_g?void 0:_g.length)&&void 0!==_h?_h:0)>0},code:()=>{const E=_a$1.wombTattoosEffects;for(const e in E){const effect=E[e];effect.timerCode&&(null==effect||effect.timerCode())}}},{name:"HaveWombTattoosEffectsHandle2",priority:12,timeInterval:16,preconditions:()=>0!=_a$1.screenFlickerIntensity,code:()=>{_a$1.wombTattoosEffects.pinkShock.timerCode2()}}]}Load(){window.EdgeCount=0,hookFunction("CharacterLoadCanvas",0,((args,next)=>(args[0]===Player&&this.checkHaveWombTattoosToAddOrRemoveEffect(),next(args))));const hookList={},WE=_a$1.wombTattoosEffects;for(const e in WE){const hookItem=WE[WE[e].name].hook;if(hookItem)for(const i in hookItem)hookList[i]?hookList[i].push([hookItem[i].hook,hookItem[i].priority]):hookList[i]=[[hookItem[i].hook,hookItem[i].priority]]}for(const fn in hookList)for(const h in hookList[fn])hookFunction(fn,hookList[fn][h][1],hookList[fn][h][0]);this.Loaded=!0}static get PlayerWombTattoos(){for(const item of Player.Appearance)if("WombTattoos"===item.Asset.Name)return item;return null}onHaveWombTattoos(checkLayer=!1){DataModule.SaveData({haveWombTattoos:!checkLayer||_a$1.haveWombTattoos(Player)})}offHaveWombTattoos(checkLayer=!1){DataModule.SaveData({haveWombTattoos:!!checkLayer&&_a$1.haveWombTattoos(Player)})}checkHaveWombTattoosToAddOrRemoveEffect(){_a$1.haveWombTattoos(Player)?(this.onHaveWombTattoos(),_a$1.isCheckWombTattoosEffect=!0):(this.offHaveWombTattoos(),_a$1.isCheckWombTattoosEffect=!1)}get wombTattoosLayers(){return this.wombTattoosLayers_data?this.wombTattoosLayers_data:this.wombTattoosLayers_data=this.getWombTattoosLayers()}getWombTattoosLayers(){var _b,_c;return null===(_c=(null===(_b=AssetFemale3DCG.find((group=>"BodyMarkings"===group.Group)))||void 0===_b?void 0:_b.Asset).find((item=>"WombTattoos"===item.Name)))||void 0===_c?void 0:_c.Layer}static haveWombTattoos(C){for(const item of C.Appearance)if("WombTattoos"===item.Asset.Name)return!0;return!1}static checkPlayerHaveWombTattoos(){var _b,_c;return null!==(_c=null===(_b=Player.XSA)||void 0===_b?void 0:_b.data.haveWombTattoos)&&void 0!==_c&&_c}static getAppliedLayerNames(C){var _b;const appliedLayersNames=[],wombTattoos=null===(_b=C.DrawAppearance)||void 0===_b?void 0:_b.find((item=>"WombTattoos"===item.Asset.Name));if(wombTattoos){const asset=wombTattoos.Asset;if(InventoryChatRoomAllow(asset.Category)){const typeRecord=wombTattoos.Property&&wombTattoos.Property.TypeRecord,appliedLayers=asset.Layer.filter((layer=>function(C,layer,typeRecord=null){return!(layer.AllowTypes&&null!==typeRecord&&!CharacterAppearanceAllowForTypes(layer.AllowTypes,typeRecord))}(0,layer,typeRecord))),results=appliedLayers.map((item=>item.Name));for(const name of results)null!==name&&appliedLayersNames.push(name)}}return appliedLayersNames}static PinkShock(){var _b;AudioPlayInstantSound("Audio/Shocks.mp3"),SendActivity(`${PH_s}的淫纹突然发出一丝诱人的波动，释放出一道电流!`,Player.MemberNumber),InventoryShockExpression(Player);const currentProgress=null===(_b=Player.ArousalSettings)||void 0===_b?void 0:_b.Progress,addedProgress=(null!=currentProgress?currentProgress:0)+30;addedProgress>100?(ActivitySetArousal(Player,100),ActivityOrgasmPrepare(Player)):ActivitySetArousal(Player,addedProgress)}}_a$1=WombTattoosModule,WombTattoosModule.isCheckWombTattoosEffect=!1,WombTattoosModule.wombTattoosLayersName=["Zoom","Big","Bloom","BottomSpike","Flash","Fly","Grass","Grow","GrowHollow","HeartSmallOutline","Heartline","HeartSmall","HeartSolid","HeartWings","In","Leaves","MidSpike","Ribow","Sense","Shake","SideHearts","Swim","Thorn","ThornOut","TopSpike","Venom","Viper","Waves","WingSmall"],WombTattoosModule.wombTattoosEffects={sensitive:{name:"sensitive",layers:["Leaves"],hook:{ActivityTimerProgress:{priority:3,hook:(args,next)=>{var _b,_c,_d,_e;if(args[0]==Player){const data=null===(_b=PlayerStorage())||void 0===_b?void 0:_b.data.WombTattoosAppliedEffects;if(null==data?void 0:data.find((e=>"sensitive"===e))){conDebug({name:"sensitive触发 处理前",type:MSGType.DebugLog,content:args[1]},"rgba(200, 154, 190, 1)");const sensitiveLevel=null!==(_e=null===(_d=null===(_c=PlayerStorage())||void 0===_c?void 0:_c.data)||void 0===_d?void 0:_d.sensitiveLevel)&&void 0!==_e?_e:1;args[1]=args[1]*(2+.5*(sensitiveLevel-1)),conDebug({name:"sensitive触发 处理后",type:MSGType.DebugLog,content:args[1]},"rgba(200, 154, 190, 1)")}}return next(args)}}}},pinkShock:{name:"pinkShock",layers:["Flash"],timerCode:()=>{var _b,_c;(null===(_c=null===(_b=PlayerStorage())||void 0===_b?void 0:_b.data)||void 0===_c?void 0:_c.WombTattoosAppliedEffects.includes("pinkShock"))&&Math.random()<.003&&(_a$1.PinkShock(),_a$1.screenFlickerIntensity=.8)},timerCode2:()=>{_a$1.screenFlickerIntensity-=.025,_a$1.screenFlickerIntensity<0&&(_a$1.screenFlickerIntensity=0)},hook:{"Player.HasTints":{priority:3,hook:(args,next)=>{var _b,_c;return((null===(_b=Player.ImmersionSettings)||void 0===_b?void 0:_b.AllowTints)||0!=_a$1.screenFlickerIntensity)&&!!(null===(_c=PlayerStorage())||void 0===_c?void 0:_c.data.WombTattoosAppliedEffects.includes("pinkShock"))||next(args)}},"Player.GetTints":{priority:3,hook:(args,next)=>{var _b,_c;return((null===(_b=Player.ImmersionSettings)||void 0===_b?void 0:_b.AllowTints)||0!=_a$1.screenFlickerIntensity)&&(null===(_c=PlayerStorage())||void 0===_c?void 0:_c.data.WombTattoosAppliedEffects.includes("pinkShock"))?[{r:255,g:100,b:196,a:_a$1.screenFlickerIntensity}]:next(args)}}}}},WombTattoosModule.screenFlickerIntensity=0;const timeRangeRegex=/^(((0|1)\d|2[0-3]):[0-5]\d)-(((0|1)\d|2[0-3]):[0-5]\d)$/;class CommandsModule extends BaseModule{constructor(){super(...arguments),this.commandsDict={help:{Tag:"help",Description:"显示 [小酥的活动模组] 的相关命令.",Action:(args,msg,parsed)=>{this.DisplayHelp()}},export:{Tag:"export",Description:"导出当前聊天室的聊天记录. 输入: ‘/xsa export -h’ 显示导出命令的使用方法.",Action:(args,msg,parsed)=>{const params=this.getCommandParameters(parsed);if("h"==params)ChatRoomSendLocal("输入: ‘/xsa export -[时间]’导出指定时间范围内的聊天记录.\n例如: ‘/xsa export -05:34-20:40’\n默认导出当前聊天室的全部聊天记录.\n注意! \n如果时间段过长例如第一天的05:34到第二天的06:00则可能出现导出错误.",2e4);else if(""===params)conDebug("导出当前聊天室的全部聊天记录"),GetModule("ChatroomModule").ExportChat();else if(timeRangeRegex.test(params)){conDebug(`导出指定的 ${params} 时间段的聊天记录`);const separatorIndex=params.indexOf("-");if(-1!==separatorIndex){const time_limit={minTime:params.slice(0,separatorIndex).trim(),maxTime:params.slice(separatorIndex+1).trim()};GetModule("ChatroomModule").ExportChat(time_limit)}}}},v:{Tag:"v",Description:"显示 [小酥的活动模组] 的版本信息.",Action:(args,msg,parsed)=>{!function(){let content="";for(const c in CHANGELOG){const version=CHANGELOG[c].version,type=CHANGELOG[c].type==ChangeType.main?"主版本":"开发版本",description=CHANGELOG[c].description,changes=CHANGELOG[c].changes;let changesString='<ul style="list-style-position: inside;  padding-left: 0;">';for(const s of changes)changesString+=`<li>${s}</li>`;changesString+="</ul>";const styleForP='style="font-weight: bold; margin: 0;"';content+=`<div style="background-color: ${version!=XSActivity_VERSION||DEBUG||"主版本"!==type?"#442E3A":"#764460"}; display: flex; flex-direction: column;"> <p ${styleForP}>版本: ${version}</p> <p ${styleForP}>类型: ${type}</p> <p ${styleForP}>描述: ${description}</p><p>----</p> <p ${styleForP}>改动: ${changesString}</p><p>========</p></div>`}content+="<p>==当前页面显示时间1分钟==</p>",ChatRoomSendLocal(content,6e4)}()}},act:{Tag:"act",Description:"显示 [小酥的活动模组] 所添加的全部动作列表.",Action:(args,msg,parsed)=>{let content="";GetModule("ActivityModule").getAllAct().forEach((item=>{content+=`<p style="font-weight: bold; margin: 0;">${item}</p>`})),conDebug(`command: AL    content: ${content}`),ChatRoomSendLocal(content,2e4)}},jieba:{Tag:"jieba",Description:"显示 自动结巴效果 的命令帮助.",Action:(args,msg,parsed)=>{const stressStyle="style='word-wrap: break-word;list-style: square;color: #FFCEE9;background-color: #AB6B8E;border-radius: 3px;padding: .2em .6em;margin: .2em .6em;'";ChatRoomSendLocal(`输入: <span ${stressStyle}>\`</span><span ${stressStyle}>空格</span><span style='word-wrap: break-word;list-style: square;color: #B0809B;background-color: #AB6B8E;border-radius: 3px;padding: .2em .6em;margin: .2em .6em;'>空格</span> 开头的话将以口吃结巴的形式发出.\n结巴生效位置有两种方式: 如果键入两个<span ${stressStyle}>空格</span> 将会在空格位置概率产生结巴效果.\n如果键入一个<span ${stressStyle}>空格</span>将会使用分词系统进行结巴效果.\n该命令有一个可选参数:\n如果以<span ${stressStyle}>\`</span><span ${stressStyle}>[1-9]</span> 的形式作为开头，数字代表结巴程度，默认为3，越高将越口吃.\n不带结巴程度参数的例子:\n<span ${stressStyle}>\`</span> [要说 的 话]\n处理之后的效果就可能是:  「 要说...-的-的话... 」=>注意空格的位置.\n带参数的命令方法:\n<span ${stressStyle}>\`</span>3 [要说 的 话]\n此处的3就是结巴等级，代表着每处句子中的空格位置的词段都将有30%的概率发生结巴.上面的话就意味着发生了3等级的结巴效果.\n如果有两个空格: <span ${stressStyle}>\`</span>  [要说的话]\n💡另外: 如果数字后跟<span ${stressStyle}>m</span>结尾，则会在结巴处根据当前兴奋程度添加呻吟效果.`)}},edge:{Tag:"edge",Description:"显示 关于边缘机制的修改内容帮助.",Action:(args,msg,parsed)=>{ChatRoomSendLocal("模组修改了的边缘机制:\n每持续45秒钟边缘 ,将提高一层高潮抵抗难度，并且增加0.3~1.3秒的即将到来的高潮的持续时间-最多27秒持续时间.\n 如果失去边缘状态，将每45秒钟降低一层高潮抵抗难度，并且减少0.3~1.3秒的即将到来的高潮的持续时间-最少高潮持续时间范围4~7秒.\n\n")}},orgasm:{Tag:"orgasm",Description:"显示 关于高潮机制的修改内容帮助.",Action:(args,msg,parsed)=>{ChatRoomSendLocal("当角色抵抗高潮时被挠痒，则重新开始抵抗并且增加一层难度\n当高潮或抵抗高潮时禁用输入框.")}},kaomoji:{Tag:"kaomoji",Description:"显示 快速颜文字 的使用说明.",Action:()=>{const stressStyle="style='word-wrap: break-word;list-style: square;color: #FFCEE9;background-color: #AB6B8E;border-radius: 3px;padding: .2em .6em;margin: .2em .6em;'";ChatRoomSendLocal(`输入<span ${stressStyle}>|</span>+<span style='word-wrap: break-word;list-style: square;color: #B0809B;background-color: #AB6B8E;border-radius: 3px;padding: .2em .6em;margin: .2em .6em;'>参数</span>，或点击聊天室输入栏下方的小按钮，显示颜文字面板。\n                左键点击表情: 将表情插入到输入栏的光标当前位置;\n                右键点击表情: 将表情以**星号消息的形式直接发出;\n                中键点击表情: 将表情以普通消息发出.\n                当前的参数有:\n                <span ${stressStyle}>help</span>显示所有的参数作用。\n                <span ${stressStyle}>all</span>显示全部表情包。\n                <span ${stressStyle}>hp</span>显示开心的颜文字包。\n                <span ${stressStyle}>sd</span>显示伤心的颜文字包。\n                <span ${stressStyle}>sy</span>显示害羞的颜文字包。\n                <span ${stressStyle}>ar</span>显示生气的颜文字包。\n                <span ${stressStyle}>sp</span>显示惊讶的颜文字包。\n                <span ${stressStyle}>cf</span>显示疑惑的颜文字包。\n                <span ${stressStyle}>nt</span>显示顽皮搞怪的颜文字包。\n                `)}},wttest:{Tag:"wttest",Description:"测试淫纹模块",Action:(args,msg,parsed)=>{if(0==parsed.length)return void conDebug("没有指令");const params=this.getCommandParameters(parsed),WombTattoosModuleExample=GetModule("WombTattoosModule");switch(params){case"get_womb_tattoos_layers":conDebug({name:"WombTattoosModule layers",type:MSGType.DebugLog,content:WombTattoosModuleExample.wombTattoosLayers});break;case"player_have_wt":conDebug({name:"haveWombTattoos",type:MSGType.DebugLog,content:WombTattoosModule.haveWombTattoos(Player)});break;case"get_applied_layer_names":conDebug({name:"getAppliedLayerNames",type:MSGType.DebugLog,content:WombTattoosModule.getAppliedLayerNames(Player)})}}}}}Load(){CommandCombine({Tag:"xsa",Description:"显示 [小酥的活动模组] 的相关命令.",Action:(args,msg,parsed)=>{parsed.length>0?this.CommandHandler(parsed):this.DisplayHelp()}}),this.Loaded=!0}Init(){this.moduleName="CommandsModule",this.priority=20}getCommandParameters(parsed){const lastParam=parsed[parsed.length-1];return lastParam.startsWith("-")?lastParam.slice(1):""}DisplayHelp(msg=void 0){if(void 0===msg){let content="";for(const c in this.commandsDict)content+=`/xsa ${c} ${this.commandsDict[c].Description}\n`;content+=`小酥的活动模组 版本号: ${XSActivity_VERSION}\n`,ChatRoomSendLocal(content,1e4)}else ChatRoomSendLocal(msg,1e4)}CommandHandler(parsed){var _a,_b,_c,_d;const parsedCount=parsed.length;if(0==parsedCount&&this.DisplayHelp(),parsedCount>=1){const last=parsed[parsedCount-1];if(last.startsWith("-")){const cmd=parsed[parsedCount-2];cmd in this.commandsDict&&(null===(_b=null===(_a=this.commandsDict[cmd])||void 0===_a?void 0:_a.Action)||void 0===_b||_b.call(_a,"","",parsed))}else last in this.commandsDict&&(null===(_d=null===(_c=this.commandsDict[last])||void 0===_c?void 0:_c.Action)||void 0===_d||_d.call(_c,"","",parsed))}}}class ArousalModule extends BaseModule{constructor(){super(...arguments),this.descriptionOfEnduranceActivities=["{source}脚趾一蜷一缩，难耐的交织.","{source}闭眼忍耐，鼻息中泄露出粉红的喘息.","{source}蜷缩脚趾忍耐着连续的快感.","{source}难耐的双腿颤抖着，身体的每一处都充满快感.","{source}拼命咬住牙齿，却从鼻腔泄露出诱人的声音.","{source}在汹涌的快感下浑身粉红，奋力的想要忍住高潮.","{source}浑身颤抖的抵抗高潮的逼近."],this.inputDefaultStyle=void 0}Init(){this.moduleName="ArousalModule",this.priority=60,TimerProcessInjector.setProcessInjectionSequence=[{name:"EdgeTimerLastCycleCall",priority:0,preconditions:()=>{var _a;return void 0!==window.EdgeCount&&void 0!==(null===(_a=Player.ArousalSettings)||void 0===_a?void 0:_a.Progress)},timeInterval:45e3,code:()=>{Player.ArousalSettings.Progress>=93?(window.EdgeCount++,ActivityOrgasmGameResistCount++):(window.EdgeCount>=1&&window.EdgeCount--,ActivityOrgasmGameResistCount>=1&&ActivityOrgasmGameResistCount--)}},{name:"OrgasmTimerLastCycleCall",priority:1,preconditions:()=>"ChatRoom"==CurrentScreen&&void 0!==Player.MemberNumber,timeInterval:1500,code:()=>{var _a,_b;const inputElement=document.getElementById("InputChat"),orgasmStage=null===(_a=Player.ArousalSettings)||void 0===_a?void 0:_a.OrgasmStage;2==orgasmStage||1==orgasmStage?(this.setFormElementsForAbsentState(inputElement,!0),1==(null===(_b=Player.ArousalSettings)||void 0===_b?void 0:_b.OrgasmStage)&&Math.random()<.3&&SendActivity(this.getEndureDesc,Player.MemberNumber)):this.setFormElementsForAbsentState(inputElement,!1)}}]}Load(){window.EdgeCount=0,this.patchListHandler(),this.Loaded=!0}get getEndureDesc(){return this.descriptionOfEnduranceActivities[Math.floor(Math.random()*this.descriptionOfEnduranceActivities.length)]}setFormElementsForAbsentState(formElements,isAbsent){formElements&&(isAbsent?formElements.readOnly||(this.inputDefaultStyle||(this.inputDefaultStyle={backgroundColor:formElements.style.backgroundColor,borderColor:formElements.style.borderColor,borderRadius:formElements.style.borderRadius}),formElements.readOnly=!0,formElements.style.backgroundColor="#8d6f83",formElements.style.borderColor="#ea44a9",formElements.style.borderRadius="5px"):formElements.readOnly&&(formElements.readOnly=!1,this.inputDefaultStyle&&(formElements.style.backgroundColor=this.inputDefaultStyle.backgroundColor,formElements.style.borderColor=this.inputDefaultStyle.borderColor,formElements.style.borderRadius=this.inputDefaultStyle.borderRadius)))}patchListHandler(){var functionName,patches;functionName="ActivityOrgasmStart",patches={"C.ArousalSettings.OrgasmTimer = CurrentTime + (Math.random() * 10000) + 5000;":"if (window.EdgeCount === undefined) {\n                C.ArousalSettings.OrgasmTimer = CurrentTime + (Math.random() * 10000) + 5000;\n            } else {\n                const addedTime = (Math.random() + 0.3) * 1000 * window.EdgeCount;\n                C.ArousalSettings.OrgasmTimer = CurrentTime + (addedTime > 20000 ? 20000 : addedTime) + 4000 + (3000 * Math.random());\n            }","ActivityOrgasmGameResistCount = 0;":"ActivityOrgasmGameResistCount = Math.round(ActivityOrgasmGameResistCount / 2);"},bcModSDK.patchFunction(functionName,patches)}}var _a;class ModuleLoader{static InitModules(){return this.generateModule(),void 0!==this.mList&&this.mList.sort(((a,b)=>a.priority-b.priority)).forEach((m=>{m.Init(),conDebug(`模块 ${m.moduleName} 尝试初始化完成`),this.modulesInitCount++})),this.modulesInitCount}static LoadModules(){return void 0!==this.mList&&this.mList.forEach((m=>{m.Load(),conDebug(`模块 ${m.moduleName} 已尝试加载`),this.modulesLoadCount++})),this.CheckModulesLoaded()?(this.CompleteLoadingSuccessful=!0,window.XSActivity_Loaded=!0):(this.CompleteLoadingSuccessful=!1,window.XSActivity_Loaded=!1),this.modulesLoadCount}static CheckModulesLoaded(){if(7!=this.modulesLoadCount||this.modulesInitCount!=this.modulesLoadCount)return conDebug(`模块加载失败，模块数量不匹配，初始化数量为${this.modulesInitCount}模块加载数量为${this.modulesLoadCount}，应为7`),!1;if(void 0===_a.mList)return conDebug("模块加载失败，模块列表未初始化"),!1;for(const m of _a.mList)if(!m.Loaded)return conDebug(`模块加载失败，模块 ${m.moduleName} 未加载完成`),!1;return conDebug("模块加载完成"),!0}static pushToModules(module){this.modules[module.moduleName]=module,void 0!==this.mList?this.mList.push(module):this.mList=[module]}static generateModule(){let generateModuleCount=0;for(const mN in _a.ModuleMap)"Base"!==mN&&void 0===this.modules[mN]&&(_a.ModuleMap[mN](),generateModuleCount++);return generateModuleCount}}function init(){if(window.XSActivity_Loaded)return;const InitModuleCount=ModuleLoader.InitModules();conDebug({type:MSGType.Workflow_Log,name:"XSActivity Initialized!",content:`Init ${InitModuleCount} modules `});const moduleCount=ModuleLoader.LoadModules();if(conDebug({type:MSGType.Workflow_Log,name:"XSActivity Loaded!",content:`Loaded ${moduleCount} modules    FullLoaded: ${ModuleLoader.CompleteLoadingSuccessful}`}),!ModuleLoader.CompleteLoadingSuccessful)throw new Error("XSActivity load or init failed")}return _a=ModuleLoader,ModuleLoader.modules=modules,ModuleLoader.modulesLoadCount=0,ModuleLoader.modulesInitCount=0,ModuleLoader.CompleteLoadingSuccessful=!1,ModuleLoader.ModuleMap={Base:()=>{throw new Error("Base为模块的抽象类，请勿加载")},TimerProcessInjector:()=>{_a.pushToModules(new TimerProcessInjector)},ActivityModule:()=>{_a.pushToModules(new ActivityModule)},ChatroomModule:()=>{_a.pushToModules(new ChatroomModule)},CommandsModule:()=>{_a.pushToModules(new CommandsModule)},DataModule:()=>{_a.pushToModules(new DataModule)},ArousalModule:()=>{_a.pushToModules(new ArousalModule)},WombTattoosModule:()=>{_a.pushToModules(new WombTattoosModule)}},conDebug({name:"Start Init",type:MSGType.Workflow_Log,content:"Init wait"}),null!=CurrentScreen&&"Login"!==CurrentScreen||hookFunction("LoginResponse",0,((args,next)=>{next(args),conDebug({name:"Init! Login Response caught",content:args,type:MSGType.Workflow_Log});const response=args[0];(response&&"string"==typeof response.Name&&"string"==typeof response.AccountName||!ModuleLoader.CompleteLoadingSuccessful)&&init()})),exports.init=init,exports}({});
//# sourceMappingURL=XSActivity_dev.js.map
