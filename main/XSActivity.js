var XiaoSuActivity=function(exports){"use strict";const XSActivity_VERSION="v0.3.5",DEBUG=!1;function getDefaultExportFromCjs(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var bcmodsdk={};!function(exports){!function(){const e="1.1.0";function o(e){alert("Mod ERROR:\n"+e);const o=new Error(e);throw console.error(o),o}const t=new TextEncoder;function n(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function r(e){const o=new Set;return e.filter((e=>!o.has(e)&&o.add(e)))}const i=new Map,a=new Set;function d(e){a.has(e)||(a.add(e),console.warn(e))}function s(e){const o=[],t=new Map,n=new Set;for(const r of p.values()){const i=r.patching.get(e.name);if(i){o.push(...i.hooks);for(const[o,a]of i.patches.entries())t.has(o)&&t.get(o)!==a&&d(`ModSDK: Mod '${r.name}' is patching function ${e.name} with same pattern that is already applied by different mod, but with different pattern:\nPattern:\n${o}\nPatch1:\n${t.get(o)||""}\nPatch2:\n${a}`),t.set(o,a),n.add(r.name)}}o.sort(((e,o)=>o.priority-e.priority));const r=function(e,o){if(0===o.size)return e;let t=e.toString().replaceAll("\r\n","\n");for(const[n,r]of o.entries())t.includes(n)||d(`ModSDK: Patching ${e.name}: Patch ${n} not applied`),t=t.replaceAll(n,r);return(0,eval)(`(${t})`)}(e.original,t);let i=function(o){var t,i;const a=null===(i=(t=m.errorReporterHooks).hookChainExit)||void 0===i?void 0:i.call(t,e.name,n),d=r.apply(this,o);return null==a||a(),d};for(let t=o.length-1;t>=0;t--){const n=o[t],r=i;i=function(o){var t,i;const a=null===(i=(t=m.errorReporterHooks).hookEnter)||void 0===i?void 0:i.call(t,e.name,n.mod),d=n.hook.apply(this,[o,e=>{if(1!==arguments.length||!Array.isArray(o))throw new Error(`Mod ${n.mod} failed to call next hook: Expected args to be array, got ${typeof e}`);return r.call(this,e)}]);return null==a||a(),d}}return{hooks:o,patches:t,patchesSources:n,enter:i,final:r}}function c(e,o=!1){let r=i.get(e);if(r)o&&(r.precomputed=s(r));else{let o=window;const a=e.split(".");for(let t=0;t<a.length-1;t++)if(o=o[a[t]],!n(o))throw new Error(`ModSDK: Function ${e} to be patched not found; ${a.slice(0,t+1).join(".")} is not object`);const d=o[a[a.length-1]];if("function"!=typeof d)throw new Error(`ModSDK: Function ${e} to be patched not found`);const c=function(e){let o=-1;for(const n of t.encode(e)){let e=255&(o^n);for(let o=0;o<8;o++)e=1&e?-306674912^e>>>1:e>>>1;o=o>>>8^e}return((-1^o)>>>0).toString(16).padStart(8,"0").toUpperCase()}(d.toString().replaceAll("\r\n","\n")),l={name:e,original:d,originalHash:c};r=Object.assign(Object.assign({},l),{precomputed:s(l),router:()=>{},context:o,contextProperty:a[a.length-1]}),r.router=function(e){return function(...o){return e.precomputed.enter.apply(this,[o])}}(r),i.set(e,r),o[r.contextProperty]=r.router}return r}function l(){const e=new Set;for(const o of p.values())for(const t of o.patching.keys())e.add(t);for(const o of i.keys())e.add(o);for(const o of e)c(o,!0)}function f(){const e=new Map;for(const[o,t]of i)e.set(o,{name:o,original:t.original,originalHash:t.originalHash,sdkEntrypoint:t.router,currentEntrypoint:t.context[t.contextProperty],hookedByMods:r(t.precomputed.hooks.map((e=>e.mod))),patchedByMods:Array.from(t.precomputed.patchesSources)});return e}const p=new Map;function u(e){p.get(e.name)!==e&&o(`Failed to unload mod '${e.name}': Not registered`),p.delete(e.name),e.loaded=!1,l()}function g(e,t,r){"string"==typeof e&&"string"==typeof t&&(alert(`Mod SDK warning: Mod '${e}' is registering in a deprecated way.\nIt will work for now, but please inform author to update.`),e={name:e,fullName:e,version:t},t={allowReplace:!0===r}),e&&"object"==typeof e||o("Failed to register mod: Expected info object, got "+typeof e),"string"==typeof e.name&&e.name||o("Failed to register mod: Expected name to be non-empty string, got "+typeof e.name);let i=`'${e.name}'`;"string"==typeof e.fullName&&e.fullName||o(`Failed to register mod ${i}: Expected fullName to be non-empty string, got ${typeof e.fullName}`),i=`'${e.fullName} (${e.name})'`,"string"!=typeof e.version&&o(`Failed to register mod ${i}: Expected version to be string, got ${typeof e.version}`),e.repository||(e.repository=void 0),void 0!==e.repository&&"string"!=typeof e.repository&&o(`Failed to register mod ${i}: Expected repository to be undefined or string, got ${typeof e.version}`),null==t&&(t={}),t&&"object"==typeof t||o(`Failed to register mod ${i}: Expected options to be undefined or object, got ${typeof t}`);const a=!0===t.allowReplace,d=p.get(e.name);d&&(d.allowReplace&&a||o(`Refusing to load mod ${i}: it is already loaded and doesn't allow being replaced.\nWas the mod loaded multiple times?`),u(d));const s=e=>{"string"==typeof e&&e||o(`Mod ${i} failed to patch a function: Expected function name string, got ${typeof e}`);let t=g.patching.get(e);return t||(t={hooks:[],patches:new Map},g.patching.set(e,t)),t},f={unload:()=>u(g),hookFunction:(e,t,n)=>{g.loaded||o(`Mod ${i} attempted to call SDK function after being unloaded`);const r=s(e);"number"!=typeof t&&o(`Mod ${i} failed to hook function '${e}': Expected priority number, got ${typeof t}`),"function"!=typeof n&&o(`Mod ${i} failed to hook function '${e}': Expected hook function, got ${typeof n}`);const a={mod:g.name,priority:t,hook:n};return r.hooks.push(a),l(),()=>{const e=r.hooks.indexOf(a);e>=0&&(r.hooks.splice(e,1),l())}},patchFunction:(e,t)=>{g.loaded||o(`Mod ${i} attempted to call SDK function after being unloaded`);const r=s(e);n(t)||o(`Mod ${i} failed to patch function '${e}': Expected patches object, got ${typeof t}`);for(const[n,a]of Object.entries(t))"string"==typeof a?r.patches.set(n,a):null===a?r.patches.delete(n):o(`Mod ${i} failed to patch function '${e}': Invalid format of patch '${n}'`);l()},removePatches:e=>{g.loaded||o(`Mod ${i} attempted to call SDK function after being unloaded`),s(e).patches.clear(),l()},callOriginal:(e,t,n)=>(g.loaded||o(`Mod ${i} attempted to call SDK function after being unloaded`),"string"==typeof e&&e||o(`Mod ${i} failed to call a function: Expected function name string, got ${typeof e}`),Array.isArray(t)||o(`Mod ${i} failed to call a function: Expected args array, got ${typeof t}`),function(e,o,t=window){return c(e).original.apply(t,o)}(e,t,n)),getOriginalHash:e=>("string"==typeof e&&e||o(`Mod ${i} failed to get hash: Expected function name string, got ${typeof e}`),c(e).originalHash)},g={name:e.name,fullName:e.fullName,version:e.version,repository:e.repository,allowReplace:a,api:f,loaded:!0,patching:new Map};return p.set(e.name,g),Object.freeze(f)}function h(){const e=[];for(const o of p.values())e.push({name:o.name,fullName:o.fullName,version:o.version,repository:o.repository});return e}let m;const y=function(){if(void 0===window.bcModSdk)return window.bcModSdk=function(){const o={version:e,apiVersion:1,registerMod:g,getModsInfo:h,getPatchingInfo:f,errorReporterHooks:Object.seal({hookEnter:null,hookChainExit:null})};return m=o,Object.freeze(o)}();if(n(window.bcModSdk)||o("Failed to init Mod SDK: Name already in use"),1!==window.bcModSdk.apiVersion&&o(`Failed to init Mod SDK: Different version already loaded ('1.1.0' vs '${window.bcModSdk.version}')`),window.bcModSdk.version!==e&&(alert(`Mod SDK warning: Loading different but compatible versions ('1.1.0' vs '${window.bcModSdk.version}')\nOne of mods you are using is using an old version of SDK. It will work for now but please inform author to update`),window.bcModSdk.version.startsWith("1.0.")&&void 0===window.bcModSdk._shim10register)){const e=window.bcModSdk,o=Object.freeze(Object.assign(Object.assign({},e),{registerMod:(o,t,n)=>o&&"object"==typeof o&&"string"==typeof o.name&&"string"==typeof o.version?e.registerMod(o.name,o.version,"object"==typeof t&&!!t&&!0===t.allowReplace):e.registerMod(o,t,n),_shim10register:!0}));window.bcModSdk=o}return window.bcModSdk}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=y}()}(bcmodsdk);var bcModSDKRef=getDefaultExportFromCjs(bcmodsdk);const MODULES={};var ChangeType;window.MODULES=MODULES,function(ChangeType){ChangeType[ChangeType.main=0]="main",ChangeType[ChangeType.dev=1]="dev"}(ChangeType||(ChangeType={}));const CHANGELOG=[{version:"0.0.1",description:"Initial release",type:ChangeType.dev,changes:["å®ŒæˆåŸºæœ¬æ¡†æ¶æµ‹è¯•ä¸­..."]},{version:"0.0.2",description:"ä¿®å¤",type:ChangeType.dev,changes:["ä¿®å¤è‹¥å¹²bug","æ·»åŠ éƒ¨åˆ†åŠ¨ä½œ"]},{version:"0.0.3",description:"ä¿®å¤",type:ChangeType.dev,changes:["ä¿®å¤è‹¥å¹²bug","å®Œå–„æ¡†æ¶"]},{version:"0.0.4",description:"ç»ˆäºä¿®å¤äº†é‡å¤åŠ è½½çš„Bug",type:ChangeType.dev,changes:["ä¿®å¤é‡å¤åŠ è½½çš„BUG!!!!!! O.o","ä¿®å¤è‹¥å¹²å…¶ä»–bug","å®Œå–„æ¡†æ¶"]},{version:"0.0.5",description:"ä¼˜åŒ–",type:ChangeType.dev,changes:["ä¼˜åŒ–ç‰ˆæœ¬ä¿¡æ¯æ˜¾ç¤ºæ•ˆæœ"]},{version:"0.1.0",description:"æ­£å¼å‘å¸ƒ!å½“å‰åŠŸèƒ½å¦‚ä¸‹: ",type:ChangeType.main,changes:["ä½¿ç”¨å‘½ä»¤å¯¼å‡ºå½“å‰èŠå¤©å®¤èŠå¤©è®°å½• æ”¯æŒæŒ‰æ—¶é—´èŒƒå›´å¯¼å‡º è¯¦ç»†è¯·æŸ¥çœ‹ /xsa ","æ·»åŠ 9ä¸ªé¢å¤–åŠ¨ä½œ."]},{version:"0.1.1",description:"æ·»åŠ äº†æ–°çš„åŠ¨ä½œ.",type:ChangeType.main,changes:["æ·»åŠ äº†é¢å¤–çš„17ä¸ªåŠ¨ä½œ","æ·»åŠ  /xsa act å‘½ä»¤ æ˜¾ç¤ºæ·»åŠ çš„å…¨éƒ¨åŠ¨ä½œ","å®ŒæˆåŠŸèƒ½è‡ªåŠ¨å£åƒå¤„ç†å‘½ä»¤:(` + message) --è¯·è¾“å…¥ /xsa jieba æŸ¥çœ‹å¸®åŠ©"]},{version:"0.1.2",description:"æ·»åŠ ä¿®æ”¹è¾¹ç¼˜é€»è¾‘.",type:ChangeType.main,changes:["ä¿®å¤ä¸€äº›bug","ä¿®å¤äº†è‹¥å¹²é”™åˆ«å­—","ä¿®æ”¹è¾¹ç¼˜å½±å“ï¼Œç°åœ¨æ¯45ç§’é’Ÿ è¾¹ç¼˜ ,å°†æé«˜ä¸€å±‚é«˜æ½®æŠµæŠ—éš¾åº¦ï¼Œå¹¶ä¸”å¢åŠ 0.3~1.3ç§’çš„å³å°†åˆ°æ¥çš„é«˜æ½®çš„æŒç»­æ—¶é—´-æœ€å¤š27ç§’æŒç»­æ—¶é—´ï¼Œå¦‚æœå¤±å»è¾¹ç¼˜çŠ¶æ€ï¼Œåˆ™åŒæ ·çš„æ—¶é—´åå¤±å»ä¸€å±‚æŠµæŠ—éš¾åº¦ï¼Œå¹¶ä¸”å‡å°‘0.3~1.3ç§’é«˜æ½®æŒç»­æ—¶é—´."]},{version:"0.1.3",description:"æ·»åŠ ä¿®æ”¹è¾¹ç¼˜é€»è¾‘ä»¥åŠé«˜æ½®æ•ˆæœ.æ·»åŠ æ‰“æ–­æŠµæŠ—é«˜æ½®çš„ç˜™ç—’åŠ¨ä½œ.",type:ChangeType.main,changes:["å½“è§’è‰²æŠµæŠ—é«˜æ½®æ—¶è¢«æŒ ç—’ï¼Œåˆ™é‡æ–°å¼€å§‹æŠµæŠ—å¹¶ä¸”å¢åŠ ä¸€å±‚éš¾åº¦","å½“é«˜æ½®æˆ–æŠµæŠ—é«˜æ½®æ—¶ç¦ç”¨è¾“å…¥æ¡†."," ` å‘½ä»¤ä¿®æ”¹ï¼Œç°åœ¨å¯ä»¥åœ¨ ` åæˆ–è€… æ•°å­—åè·Ÿä¸€ä¸ªå­—æ¯ m ï¼Œè¿™å°†åœ¨ç»“å·´ä½ç½®æ·»åŠ å‘»åŸæ•ˆæœ."]},{version:"0.1.4",description:"æ·»åŠ é¢œæ–‡å­—å¿«é€Ÿå‘é€åŠŸèƒ½!",type:ChangeType.main,changes:["æ·»åŠ å¿«é€Ÿå‘é€é¢œæ–‡å­—çš„åŠŸèƒ½ï¼Œä»¥ä¸‹ä¸ºç®€å•ä»‹ç»ï¼Œè¯¦ç»†ä»‹ç»è¯·è¾“å…¥:/xsa kaomoji æŸ¥çœ‹ã€‚\nä½¿ç”¨=> |+[å‚æ•°]  æ‰“å¼€é¢œæ–‡å­—é€‰æ‹©é¢æ¿ï¼Œ| ä¸ºå›è½¦ä¸Šé¢çš„æŒ‰é”®ï¼Œéœ€è¦ç”¨ Shift+\\ é”®æ‰“å‡º è¯·è¾“å…¥ |help æŸ¥çœ‹å…¨éƒ¨å‚æ•°","è°ƒæ•´å¿è€é«˜æ½®æ—¶æ¯1.5ç§’æœ‰30%æ¦‚ç‡å‘é€å¿è€ååº”","é«˜æ½®åçš„é«˜æ½®æŠµæŠ—éš¾åº¦åªé™ä½ä¸€åŠè€ŒéåŸæ¥çš„é™ä½ä¸º0.","é‡æ„æ³¨å…¥åˆ°åŠ¨ä½œå¾ªç¯çš„é€»è¾‘","é‡æ„æ¨¡ç»„çš„åˆå§‹åŒ–ä¸åŠ è½½é€»è¾‘"]},{version:"0.1.5",description:"é¢œæ–‡å­—å‘é€åŠŸèƒ½å¤§ä¿®!",type:ChangeType.main,changes:["é¢œæ–‡å­—è¡¨æƒ…åŠŸèƒ½å¤§ä¿®! æ–°ç‰ˆä½¿ç”¨æ–¹æ³•è¯·è¾“å…¥/xsa kaomoji æŸ¥çœ‹!"]},{version:"0.2.0",description:"æ·«çº¹å¤§ä¿®!  å¾…ç»­!",type:ChangeType.main,changes:["æ·«çº¹å¤§ä¿®! è¾“å…¥ /xsa yw æŸ¥çœ‹åŠŸèƒ½.","é«˜æ½®æŠµæŠ—éš¾åº¦å’Œæ¸©åº¦è®¡è¿›åº¦ç°åœ¨å¯ä»¥è·¨å¹³å°ç»§æ‰¿ æ¢å¥è¯è¯´ æ‰çº¿ä¹Ÿä¸ä¼šä¸¢å¤±ç›¸å…³æ•°æ®","å–æ¶ˆäº†åŸæ¥çš„è¾¹ç¼˜è®¡æ•°ï¼Œç°åœ¨è¾¹ç¼˜ç­‰çº§å’ŒæŠµæŠ—éš¾åº¦ä½¿ç”¨åŒä¸€å˜é‡"]},{version:"0.3.0",description:"æ·»åŠ äº†æ–°çš„åŠ¨ä½œ(ç§»æ¤äº†éƒ¨åˆ†æµ®ç»˜çš„SubåŠ¨ä½œ)ï¼Œä½†æš‚æ—¶ç§»é™¤äº†å…³äºè¾¹ç¼˜å’Œé«˜æ½®æœºåˆ¶çš„ä¿®æ”¹!",type:ChangeType.main,changes:["å°†æµ®ç»˜çš„SubåŠ¨ä½œæ¨¡ç»„çš„éƒ¨åˆ†(å¤§é‡!)åŠ¨ä½œç§»æ¤è¿‡æ¥ï¼Œæ„Ÿè°¢æµ®ç»˜çš„æˆæƒ! åŸåŠ¨ä½œMod:[https://github.com/FuhuiNeko/BC_Mods]","æš‚æ—¶ç§»é™¤äº†è¾¹ç¼˜é«˜æ½®æœºåˆ¶çš„ä¿®æ”¹.","æš‚æ—¶ç§»é™¤äº†æ·«çº¹åŠŸèƒ½çš„å¤§ä¿®","é™¤äº†åŠ¨ä½œéƒ¨åˆ†ï¼ŒåŠŸèƒ½å°†æ¸æ¸ç§»æ¤åˆ°æ–°Mod","æ–°Modé“¾æ¥: [https://github.com/iceriny/XiaosuBCExpansion]","ç­‰æ–°ModåŠŸèƒ½å®Œå–„å°†ä¼šåœ¨æ­¤Modæ›´æ–°ä¸­æç¤º!","æ–°Modçš„å½“å‰ç‰ˆæœ¬å·²å®Œæˆ: é«˜æ½®æœºåˆ¶ä¿®æ”¹(æœ¬Modç§»æ¤)ã€è¾¹ç¼˜æœºåˆ¶ä¿®æ”¹(æœ¬Modç§»æ¤)ã€\né«˜æ½®ä½™éŸµç³»ç»Ÿ(æš‚æ— ä»‹ç»ï¼Œè¯·è‡ªè¡Œæ¢ç´¢ å°†æ¥çš„ç‰ˆæœ¬å°†å®Œå–„ä»‹ç»ï¼Œä»¥åŠæ·«çº¹å¤§ä¿®å°†ä¾èµ–äºæ­¤åŠŸèƒ½)"]},{version:"0.3.3",description:"æ·»åŠ äº†äº”å­æ£‹å›´æ£‹å¯¹å±€åŠŸèƒ½!",type:ChangeType.main,changes:["äº”å­æ£‹æˆ–å›´æ£‹çš„å¯¹å±€åŠŸèƒ½ï¼Œè¯¦ç»†ä»‹ç»è¯·è¾“å…¥ `/xsa chess -h` æŸ¥çœ‹ã€‚","ä¿®å¤äº†éƒ¨åˆ†bugã€‚"]},{version:"0.3.4",description:"å¯¼å‡ºèŠå¤©è®°å½•å¯ä»¥ç²¾ç¡®åˆ°ç§’äº†; å‘½ä»¤å¢åŠ è‡ªåŠ¨è¡¥å…¨",type:ChangeType.main,changes:["å‘½ä»¤åŠŸèƒ½ç°åœ¨å¯ä»¥åœ¨è¾“å…¥é¦–å­—æ¯åè‡ªåŠ¨è¡¥å…¨äº†ï¼Œä¾‹å¦‚ï¼Œè¾“å…¥`/x`ç„¶åæŒ‰Tabé”®å°†è‡ªåŠ¨è¡¥å…¨ä¸º`/xsa`ï¼Œåœ¨`/xsa`åè¾“å…¥ç©ºæ ¼åŠ `c`(å³`/xsa c`)ç„¶åæŒ‰ä¸‹ç©ºæ ¼åˆ™è‡ªåŠ¨è¡¥å…¨ä¸º`/xsa chess`","ç°åœ¨èŠå¤©è®°å½•ä¸­çš„æ—¶é—´æ ‡è®°å°†æ˜¾ç¤ºç²¾ç¡®åˆ°ç§’.","ç°åœ¨æŒ‰æ—¶é—´èŒƒå›´å¯¼å‡ºèŠå¤©è®°å½•çš„åŠŸèƒ½å¯ä»¥ç²¾ç¡®åˆ°ç§’äº†."]},{version:"0.3.5",description:"æ·»åŠ èŠå¤©å®¤èŠå¤©è®°å½•çš„å³é”®èœå•",type:ChangeType.main,changes:["å³é”®èŠå¤©è®°å½•çš„æ¡ç›®å¯ä»¥å‘¼å‡ºå³é”®èœå•","å¦‚æœæœ‰å®‰è£…æœ¬æ’ä»¶ `å›å¤` åŠŸèƒ½æ˜¾ç¤ºç‰¹æ®Šæ•ˆæœ å¦‚æœæ²¡æœ‰å®‰è£…è¢«æ’ä»¶å°†æ˜¾ç¤ºä¸ºæ™®é€šçš„æ­£å¸¸è¯´è¯çš„æ¶ˆæ¯ã€‚"]}],CSShref=DEBUG?"https://iceriny.github.io/XiaoSuActivity/dev/XSActivityStyle.css":"https://iceriny.github.io/XiaoSuActivity/main/XSActivityStyle.css",bcModSDK=bcModSDKRef.registerMod({name:"XiaoSuActivity",fullName:"XiaoSu's Activity Expand",version:XSActivity_VERSION.startsWith("v")?XSActivity_VERSION.slice(1):XSActivity_VERSION,repository:"https://github.com/iceriny/XiaoSuActivity"});function hookFunction(target,priority,hook){return bcModSDK.hookFunction(target,priority,hook)}function SendLocalMessage(msg,className=null,timeout=0){null!==className&&(msg=`<div class="${className}">${msg}</div>`),0===timeout?ChatRoomSendLocal(msg):ChatRoomSendLocal(msg,timeout)}var MSGType;function conDebug(msg,isError=!1,color=null,style=null){if(!1===DEBUG)return;const result="string"==typeof msg?{name:"XiaoSuActivity_Debug",type:MSGType.DebugLog,content:msg,time:(new Date).toLocaleString(),ModVersion:XSActivity_VERSION}:{name:msg.name,type:msg.type,content:msg.content,time:(new Date).toLocaleString(),ModVersion:XSActivity_VERSION};if(style)console.debug("%cå°é…¥çš„æ¨¡ç»„ä¿¡æ¯: ",style,result);else{let theColor="rgba(191, 154, 175, 1)";isError&&(theColor="rgba(255, 0, 0, 1)"),color&&(theColor=color),console.debug("%cå°é…¥çš„æ¨¡ç»„ä¿¡æ¯: ",`background-color: ${theColor}; font-weight: bold;`,result)}}function GetModule(moduleName){return MODULES[moduleName]}function copyAndDownloadHtmlElement(element,fileName,time_limit=null){const newDoc=document.implementation.createHTMLDocument();if(null===element)return void conDebug("element is null");const copiedElement=element.cloneNode(!0);null!==time_limit&&function(element,time_limit){element.querySelectorAll("[data-time]").forEach((element=>{const dataTimeValue=element.getAttribute("data-time");if(dataTimeValue){const currentTime=new Date(`2000-01-01 ${dataTimeValue}`),minTimeDate=new Date(`2000-01-01 ${time_limit.minTime}`),maxTimeDate=new Date(`2000-01-01 ${time_limit.maxTime}`);maxTimeDate<minTimeDate&&maxTimeDate.setDate(maxTimeDate.getDate()+1),(currentTime<minTimeDate||currentTime>maxTimeDate)&&element.remove()}}))}(copiedElement,time_limit),function(element){const style=element.style;for(;style.length>0;)style.removeProperty(style[0])}(copiedElement),copiedElement.style.fontSize="14.784px",copiedElement.style.fontFamily="Arial, sans-serif",copiedElement.style.display="flex",copiedElement.style.flexDirection="column",copiedElement.style.width="70vw",newDoc.body.style.display="flex",newDoc.body.style.alignItems="center",newDoc.body.style.justifyContent="center",newDoc.body.style.backgroundColor="#f2f2f2",newDoc.body.appendChild(copiedElement);const htmlString=newDoc.documentElement.outerHTML,blob=new Blob([htmlString],{type:"text/html"}),link=document.createElement("a");link.href=URL.createObjectURL(blob),link.download=fileName,link.click()}function sendLastChangeLog(){let content="";const c=CHANGELOG[CHANGELOG.length-1],version=c.version,type=c.type==ChangeType.main?"ä¸»ç‰ˆæœ¬":"å¼€å‘ç‰ˆæœ¬",description=c.description,changes=c.changes,styleForP='style="margin: 0;"';for(const s of changes)content+=`<p ${styleForP}>${s}</p>`;content=`<p style="font-size: 1.5em;font-weight: bold; margin: 0;">ç‰ˆæœ¬æ›´æ–°: ${version}</p>\n    <p ${styleForP}>ç±»å‹: ${type}</p>\n    <p ${styleForP}>æè¿°: ${description}</p>\n    <p>----</p>\n    <p ${styleForP}>æ”¹åŠ¨: ${content}</p>\n    <p>========</p>`,content+="<p>==å½“å‰é¡µé¢æ˜¾ç¤ºæ—¶é—´30ç§’ å†æ¬¡æŸ¥çœ‹è¯·è¾“å…¥`/xsa new`==</p>",ChatRoomSendLocal(content,3e4)}!function(MSGType){MSGType[MSGType.DebugLog=0]="DebugLog",MSGType[MSGType.Workflow_Log=1]="Workflow_Log"}(MSGType||(MSGType={}));class BaseModule{constructor(moduleName){this.priority=0,this.Loaded=!1,this.moduleName=moduleName}}class Localization{static init(){conDebug("æœ¬åœ°åŒ–æ¨¡å—åˆå§‹åŒ–."),hookFunction("TranslationNextLanguage",0,((args,next)=>{next(args),Localization.init()})),this.getLangJson()}static getLangJson(langCode){const lang=(langCode||localStorage.getItem("BondageClubLanguage"))??"CH",href=this.LINK+`${lang}.json`;conDebug("å¼€å§‹è·å–æœ¬åœ°åŒ–æ–‡ä»¶."),conDebug(`è·å–åœ°å€: ${href}`),fetch(href).then((response=>response.json())).then((data=>{this.getCount=0,this.STRINGS=data,window.XSA_STRINGS=this.STRINGS,conDebug({name:"æœ¬åœ°åŒ–æ–‡ä»¶åŠ è½½å®Œæˆ.",content:data})})).catch((error=>{this.getCount++,this.getCount<3?(console.error("è·å–ç¿»è¯‘æ–‡ä»¶å¤±è´¥: ",error,"\n1ç§’åé‡æ–°è·å–."),setTimeout((()=>{this.getLangJson()}),1e3)):"CH"===lang?console.error("è·å–ç¿»è¯‘æ–‡ä»¶å¤±è´¥: ",error,"\n3æ¬¡å¤±è´¥."):(console.error("è·å–ç¿»è¯‘æ–‡ä»¶å¤±è´¥: ",error,"\n3æ¬¡å¤±è´¥, å°è¯•è·å–é»˜è®¤çš„ä¸­æ–‡ç¿»è¯‘."),this.getLangJson("CH"))}))}static get(firstKey,key,...param){return new STR(firstKey,key).SlotReplace(...param).Personalize().S}}Localization.LINK=DEBUG?"https://iceriny.github.io/XiaoSuActivity/dev/":"https://iceriny.github.io/XiaoSuActivity/main/",Localization.getCount=0;class STR{get S(){return this.str}constructor(firstKey,key){return Localization.STRINGS&&Localization.STRINGS[firstKey]&&Localization.STRINGS[firstKey][key]?this.str=Localization.STRINGS[firstKey][key]:this.str="[STRING_RETRIEVAL_FAILED!!]",this}SlotReplace(...param){return this.str=this.str.replace(/\{([0-9]+)\}/g,((match,digits)=>{const index=parseInt(digits,10);try{return param[index].toString()}catch(error){return console.error(`Index ${index} out of range in parameters array.`,error),match}})),this}Personalize(){return this.str=this.str.replace(/\{(he|her|it|they)\}/g,((match,pronoun)=>{try{return Localization.STRINGS.Other[pronoun]}catch(error){return console.error("æœªè·å–åˆ°äººç§°ä»£è¯ã€‚",error),match}})),this}}class ActivityModule extends BaseModule{constructor(){super(...arguments),this.activityToAddDict={"XSAct_çœ¯çœ¼":{act:{Name:"XSAct_çœ¯çœ¼",Target:[],TargetSelf:["ItemHead"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["CanLook"]},desc:null,img:"RestHead"},"XSAct_çœ¼ç¥é£˜å¿½":{act:{Name:"XSAct_çœ¼ç¥é£˜å¿½",Target:[],TargetSelf:["ItemHead"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["CanLook"]},desc:null,img:"RestHead"},"XSAct_ç”©å¤´å‘":{act:{Name:"XSAct_ç”©å¤´å‘",Target:[],TargetSelf:["ItemHood"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["ItemHoodCovered"]},desc:null,img:"RestHead"},"XSAct_å¤§åŠ›ç”©å¤´å‘":{act:{Name:"XSAct_å¤§åŠ›ç”©å¤´å‘",Target:[],TargetSelf:["ItemHood"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["ItemHoodCovered"]},desc:null,img:"RestHead"},"XSAct_è½»æŠšå‘æ¢¢":{act:{Name:"XSAct_è½»æŠšå‘æ¢¢",Target:["ItemHood"],TargetSelf:["ItemHood"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["ItemHoodCovered","TargetItemHoodCovered","UseArms"]},desc:null,img:"RestHead"},"XSAct_å¼èµ·å¤´å‘":{act:{Name:"XSAct_å¼èµ·å¤´å‘",Target:["ItemHood"],TargetSelf:["ItemHood"],MaxProgress:50,MaxProgressSelf:20,Prerequisite:["UseMouth","ItemHoodCovered","TargetItemHoodCovered"],StimulationAction:"Talk"},desc:null,img:"SiblingsCheekKiss"},"XSAct_å—…å¤´å‘":{act:{Name:"XSAct_å—…å¤´å‘",Target:["ItemHood"],TargetSelf:["ItemHood"],MaxProgress:30,MaxProgressSelf:30,Prerequisite:["ItemHoodCovered","TargetItemHoodCovered","ItemNoseCovered"],StimulationAction:"Talk"},desc:null,img:"SiblingsCheekKiss"},"XSAct_ç»•å¤´å‘":{act:{Name:"XSAct_ç»•å¤´å‘",Target:["ItemHood"],TargetSelf:["ItemHood"],MaxProgress:30,MaxProgressSelf:30,Prerequisite:["UseArms","ItemHoodCovered","TargetItemHoodCovered"]},desc:null,img:"SiblingsCheekKiss"},"XSAct_çš±é¼»å­":{act:{Name:"XSAct_çš±é¼»å­",Target:[],TargetSelf:["ItemNose"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["ItemHoodCovered","ItemNoseCovered"]},desc:null,img:"RestHead"},"XSAct_æ‰“å–·åš":{act:{Name:"XSAct_æ‰“å–·åš",Target:[],TargetSelf:["ItemNose"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["UseMouth","ItemHoodCovered"],StimulationAction:"Talk"},desc:null,img:"Kiss"},"XSAct_æ·±å‘¼å¸":{act:{Name:"XSAct_æ·±å‘¼å¸",Target:[],TargetSelf:["ItemNose"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["UseMouth","ItemHoodCovered","ItemNoseCovered"],StimulationAction:"Talk"},desc:null,img:"Kiss"},"XSAct_ä½å¤´":{act:{Name:"XSAct_ä½å¤´",Target:[],TargetSelf:["ItemHood"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["ItemHoodCovered","MoveHead"]},desc:null,img:"RestHead"},"XSAct_æ³æ±‚çš„æ‘‡å¤´":{act:{Name:"XSAct_æ³æ±‚çš„æ‘‡å¤´",Target:["ItemHead"],TargetSelf:[],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["MoveHead"]},desc:null,img:"RestHead"},"XSAct_æ³æ±‚çš„çœ‹":{act:{Name:"XSAct_æ³æ±‚çš„çœ‹",Target:["ItemHead"],TargetSelf:[],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["CanLook"]},desc:null,img:"RestHead"},"XSAct_å†…å…«å¤¹è…¿":{act:{Name:"XSAct_å†…å…«å¤¹è…¿",Target:[],TargetSelf:["ItemLegs"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"Kick"},"XSAct_å™˜å˜´":{act:{Name:"XSAct_å™˜å˜´",Target:[],TargetSelf:["ItemMouth","ItemMouth2","ItemMouth3"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["UseMouth"]},desc:null,img:"PoliteKiss"},"XSAct_æŠ¿ä½å˜´å·´":{act:{Name:"XSAct_æŠ¿ä½å˜´å·´",Target:[],TargetSelf:["ItemMouth","ItemMouth2","ItemMouth3"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["UseMouth"]},desc:null,img:"PoliteKiss"},"XSAct_ç˜ªå˜´":{act:{Name:"XSAct_ç˜ªå˜´",Target:[],TargetSelf:["ItemMouth","ItemMouth2","ItemMouth3"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["UseMouth"]},desc:null,img:"PoliteKiss"},"XSAct_åç›´èº«ä½“":{act:{Name:"XSAct_åç›´èº«ä½“",Target:[],TargetSelf:["ItemTorso","ItemTorso2"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"Kick"},"XSAct_æŒºèƒ¸æ”¶è…¹":{act:{Name:"XSAct_æŒºèƒ¸æ”¶è…¹",Target:[],TargetSelf:["ItemBreast"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"Kick"},"XSAct_ç«™ç›´èº«ä½“":{act:{Name:"XSAct_ç«™ç›´èº«ä½“",Target:[],TargetSelf:["ItemTorso","ItemTorso2"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["NotKneeling"]},desc:null,img:"Kick"},"XSAct_èº«ä½“ä¸€é¢¤":{act:{Name:"XSAct_èº«ä½“ä¸€é¢¤",Target:[],TargetSelf:["ItemTorso","ItemTorso2"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"Kick"},"XSAct_æ´»åŠ¨å¤§è…¿":{act:{Name:"XSAct_æ´»åŠ¨å¤§è…¿",Target:[],TargetSelf:["ItemLegs"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"Kick"},"XSAct_æ´»åŠ¨æ‰‹è‡‚":{act:{Name:"XSAct_æ´»åŠ¨æ‰‹è‡‚",Target:[],TargetSelf:["ItemArms"],MaxProgress:30,MaxProgressSelf:30,Prerequisite:["CantUseArms"]},desc:null,img:"MasturbateHand"},"XSAct_ç»·ç´§è†ç›–":{act:{Name:"XSAct_ç»·ç´§è†ç›–",Target:[],TargetSelf:["ItemLegs"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["NotKneeling"]},desc:null,img:"Kick"},"XSAct_ç»·ç›´è„šè¸":{act:{Name:"XSAct_ç»·ç›´è„šè¸",Target:[],TargetSelf:["ItemBoots"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"Kick"},"XSAct_èœ·ç¼©è„šè¶¾":{act:{Name:"XSAct_èœ·ç¼©è„šè¶¾",Target:[],TargetSelf:["ItemBoots"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"Kick"},"XSAct_è¸®è„š":{act:{Name:"XSAct_è¸®è„š",Target:[],TargetSelf:["ItemBoots"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["CantUseFeet"]},desc:null,img:"Kick"},"XSAct_å…´å¥‹çš„ä¼¸å‡ºèˆŒå¤´":{act:{Name:"XSAct_å…´å¥‹çš„ä¼¸å‡ºèˆŒå¤´",Target:[],TargetSelf:["ItemMouth","ItemMouth2","ItemMouth3"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["UseMouth"]},desc:null,img:"MasturbateTongue"},"XSAct_å…´å¥‹çš„æ‰­åŠ¨":{act:{Name:"XSAct_å…´å¥‹çš„æ‰­åŠ¨",Target:[],TargetSelf:["ItemTorso","ItemTorso2"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"Wiggle"},"XSAct_å‘¼å¸å¹³å¤":{act:{Name:"XSAct_å‘¼å¸å¹³å¤",Target:[],TargetSelf:["ItemNose"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"PoliteKiss"},"XSAct_å‘¼å¸ç´Šä¹±":{act:{Name:"XSAct_å‘¼å¸ç´Šä¹±",Target:[],TargetSelf:["ItemNose"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"Whisper"},"XSAct_å˜Ÿå›”ç€æƒ³è¯´ä»€ä¹ˆ":{act:{Name:"XSAct_å˜Ÿå›”ç€æƒ³è¯´ä»€ä¹ˆ",Target:[],TargetSelf:["ItemMouth","ItemMouth2","ItemMouth3"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["UseMouth"]},desc:null,img:"Whisper"},"XSAct_å¤±ç¥çš„ä¼¸å‡ºèˆŒå¤´":{act:{Name:"XSAct_å¤±ç¥çš„ä¼¸å‡ºèˆŒå¤´",Target:[],TargetSelf:["ItemMouth","ItemMouth2","ItemMouth3"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["UseMouth"]},desc:null,img:"MasturbateTongue"},"XSAct_æ…¢æ…¢ä¼¸å‡ºèˆŒå¤´":{act:{Name:"XSAct_æ…¢æ…¢ä¼¸å‡ºèˆŒå¤´",Target:[],TargetSelf:["ItemMouth","ItemMouth2","ItemMouth3"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["UseMouth"]},desc:null,img:"MasturbateTongue"},"XSAct_å¾®å¾®æ‘‡å¤´":{act:{Name:"XSAct_å¾®å¾®æ‘‡å¤´",Target:[],TargetSelf:["ItemHead"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["MoveHead"]},desc:null,img:"Suck"},"XSAct_å¾®å¾®ç‚¹å¤´":{act:{Name:"XSAct_å¾®å¾®ç‚¹å¤´",Target:[],TargetSelf:["ItemHead"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["MoveHead"]},desc:null,img:"Nod"},"XSAct_èº«ä½“é¢¤æŠ–çš„æ‘‡å¤´":{act:{Name:"XSAct_èº«ä½“é¢¤æŠ–çš„æ‘‡å¤´",Target:[],TargetSelf:["ItemHead"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["MoveHead"]},desc:null,img:"Suck"},"XSAct_èº«ä½“é¢¤æŠ–çš„ç‚¹å¤´":{act:{Name:"XSAct_èº«ä½“é¢¤æŠ–çš„ç‚¹å¤´",Target:[],TargetSelf:["ItemHead"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["MoveHead"]},desc:null,img:"Nod"},"XSAct_æ­ªå¤´ç–‘æƒ‘":{act:{Name:"XSAct_æ­ªå¤´ç–‘æƒ‘",Target:[],TargetSelf:["ItemNeck"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["MoveHead"]},desc:null,img:"Suck"},"XSAct_æ‰­åŠ¨èº«ä½“":{act:{Name:"XSAct_æ‰­åŠ¨èº«ä½“",Target:[],TargetSelf:["ItemTorso","ItemTorso2"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"Wiggle"},"XSAct_æ´»åŠ¨å››è‚¢":{act:{Name:"XSAct_æ´»åŠ¨å››è‚¢",Target:["ItemArms","ItemLegs","ItemFeet","ItemBoots"],TargetSelf:[],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["CantUseArms","CantUseFeet"]},desc:null,img:"Slap"},"XSAct_çœ‹ä»–":{act:{Name:"XSAct_çœ‹ä»–",Target:["ItemHead"],TargetSelf:[],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["CanLook"]},desc:null,img:"SiblingsCheekKiss"},"XSAct_ç¼©è„–å­":{act:{Name:"XSAct_ç¼©è„–å­",Target:[],TargetSelf:["ItemNeck"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"Suck"},"XSAct_è„¸çº¢å–˜æ°”":{act:{Name:"XSAct_è„¸çº¢å–˜æ°”",Target:[],TargetSelf:["ItemMouth","ItemMouth2","ItemMouth3"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"Whisper"},"XSAct_è½»å£°å–˜æ°”":{act:{Name:"XSAct_è½»å£°å–˜æ°”",Target:[],TargetSelf:["ItemMouth","ItemMouth2","ItemMouth3"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"Whisper"},"XSAct_è·ºè„š":{act:{Name:"XSAct_è·ºè„š",Target:[],TargetSelf:["ItemBoots"],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["NotKneeling"]},desc:null,img:"Step"},"XSAct_å¤´è¹­":{act:{Name:"XSAct_å¤´è¹­",Target:["ItemHead","ItemNeck","ItemBreast","ItemArms","ItemLegs","ItemFeet","ItemBoots","ItemPelvis"],TargetSelf:[],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"SiblingsCheekKiss",isBase:!0},"XSAct_è„¸è¹­":{act:{Name:"XSAct_è„¸è¹­",Target:["ItemHead","ItemNeck","ItemBreast","ItemArms","ItemLegs","ItemFeet","ItemBoots","ItemPelvis"],TargetSelf:[],MaxProgress:20,MaxProgressSelf:20,Prerequisite:[]},desc:null,img:"SiblingsCheekKiss",isBase:!0},"XSAct_é¼»å­è¹­":{act:{Name:"XSAct_é¼»å­è¹­",Target:["ItemHead","ItemNeck","ItemBreast","ItemArms","ItemLegs","ItemFeet","ItemBoots","ItemPelvis"],TargetSelf:[],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["MoveHead"]},desc:null,img:"Nod",isBase:!0},"XSAct_åŸ‹æ€€é‡Œ":{act:{Name:"XSAct_åŸ‹æ€€é‡Œ",Target:["ItemBreast"],TargetSelf:[],MaxProgress:20,MaxProgressSelf:20,Prerequisite:["MoveHead"]},desc:null,img:"SiblingsCheekKiss"}},this.prerequisiteDict={ItemHoodCovered:{Name:"ItemHoodCovered",Action:args=>{const acting=args[1];return this.Judgment.ItemHoodCovered(acting)}},TargetItemHoodCovered:{Name:"TargetItemHoodCovered",Action:args=>{const acted=args[2];return this.Judgment.ItemHoodCovered(acted)}},ItemNoseCovered:{Name:"ItemNoseCovered",Action:args=>{const acting=args[1];return this.Judgment.ItemNoseCovered(acting)}},Kneeling:{Name:"Kneeling",Action:args=>{const acting=args[1];return this.Judgment.Kneeling(acting)}},NotKneeling:{Name:"NotKneeling",Action:args=>{const acting=args[1];return this.Judgment.NotKneeling(acting)}},CanLook:{Name:"CanLook",Action:args=>{const acting=args[1];return this.Judgment.CanLook(acting)}}},this.Judgment={ItemHoodCovered:acting=>""===InventoryPrerequisiteMessage(acting,"HoodEmpty"),ItemNoseCovered:acting=>""==(InventoryGet(acting,"ItemNose")?"CannotBeUsedOverMask":""),Kneeling:acting=>acting.IsKneeling(),NotKneeling:acting=>!acting.IsKneeling(),CanLook:acting=>!acting.IsBlind()}}Init(){this.priority=50}Load(){this.LoadActivity(),this.hookListHandler(),this.Loaded=!0}getStr(key,...params){return Localization.get("Activity",key,...params)}hookListHandler(){hookFunction("ServerSend",5,((args,next)=>{if("ChatRoomChat"==args[0]&&"Activity"==args[1]?.Type){const data=args[1];if(0==(data.Dictionary[3]?.ActivityName??"").indexOf("XSAct_")){const{substitutions:substitutions}=ChatRoomMessageRunExtractors(data,Player);let msg=ActivityDictionaryText(data.Content);msg=CommonStringSubstitute(msg,substitutions??[]),data.Dictionary.push({Tag:"MISSING ACTIVITY DESCRIPTION FOR KEYWORD "+data.Content,Text:msg})}}return next(args)})),hookFunction("ActivityCheckPrerequisite",500,((args,next)=>{const prereq=args[0];if(prereq in this.prerequisiteDict){return this.prerequisiteDict[prereq].Action(args)}return next(args)})),hookFunction("DrawImageResize",10,((args,next)=>{const source=args[0];if("string"!=typeof source)return next(args);const parts=source.split("/"),aName=parts[parts.length-1].replace(".png","");if(0==aName.indexOf("XSAct_")){const resultName=`Assets/Female3DCG/Activity/${this.activityToAddDict[aName].img}.png`;return args[0]=resultName,next(args)}return next(args)})),hookFunction("ChatRoomMessage",this.priority,((args,next)=>{const data=args[0];if(conDebug({name:"ChatRoomMessage",type:MSGType.DebugLog,content:data}),"Activity"==data.Type){const actName=data.Dictionary[3]?.ActivityName,SourceCharacter=data.Dictionary[0]?.SourceCharacter,TargetCharacter=data.Dictionary[1]?.TargetCharacter;"Tickle"!=actName||Number.isNaN(TargetCharacter)||TargetCharacter!=Player?.MemberNumber||(conDebug({type:MSGType.DebugLog,name:"æ£€æµ‹åˆ°è‡ªå·±ä¸ºç›®æ ‡çš„ç˜™ç—’åŠ¨ä½œ",content:{"é«˜æ½®é˜¶æ®µ":Player.ArousalSettings?.OrgasmStage,"æŠµæŠ—éš¾åº¦":ActivityOrgasmGameResistCount}}),1==Player.ArousalSettings?.OrgasmStage&&(conDebug({type:MSGType.DebugLog,name:"æ•æ‰åˆ°æŠµæŠ—åœºæ™¯ï¼Œå¼€å§‹æˆªæ–­æŠµæŠ— å¢åŠ éš¾åº¦ å¹¶é‡æ–°è§¦å‘",content:{"é«˜æ½®é˜¶æ®µ":Player.ArousalSettings?.OrgasmStage,"æŠµæŠ—éš¾åº¦":ActivityOrgasmGameResistCount}}),ActivityOrgasmGameResistCount++,function(msg,sourceCharacter,targetCharacter){const sourceCharacterObj=ChatRoomCharacter.find((c=>c.MemberNumber==sourceCharacter)),targetCharacterObj=targetCharacter?ChatRoomCharacter.find((c=>c.MemberNumber==targetCharacter)):void 0;if(void 0===sourceCharacterObj&&void 0===targetCharacterObj)return;const sourceCharacterNickname=sourceCharacterObj?CharacterNickname(sourceCharacterObj):"",targetCharacterNickname=targetCharacterObj?CharacterNickname(targetCharacterObj):"",resultDict=[{Tag:"MISSING ACTIVITY DESCRIPTION FOR KEYWORD XSA_ActMessage",Text:msg.replaceAll("{source}",sourceCharacterNickname).replaceAll("{target}",targetCharacterNickname)}];resultDict.push({SourceCharacter:sourceCharacter}),void 0!==targetCharacter&&resultDict.push({TargetCharacter:targetCharacter}),conDebug({type:MSGType.Workflow_Log,name:"SendActivity()",content:{Type:"Activity",Content:"XSA_ActMessage",Dictionary:resultDict,Sender:sourceCharacter}}),ServerSend("ChatRoomChat",{Type:"Activity",Content:"XSA_ActMessage",Dictionary:resultDict,Sender:sourceCharacter})}(Localization.get("Activity","XSAct.Tickle.Resist"),SourceCharacter,TargetCharacter),ActivityOrgasmStop(Player,99.5),ActivityOrgasmPrepare(Player)))}return next(args)}))}LoadActivity(){conDebug("åŠ è½½è‡ªå®šä¹‰æ´»åŠ¨");let actLength=0;this.activityDictAdd();for(const aN in this.activityToAddDict){this.pushToActivity(this.activityToAddDict[aN].act);const activityDesc=this.activityToAddDict[aN].desc;activityDesc?.forEach((d=>{ActivityDictionary?.push(d)})),actLength+=1}conDebug(`è‡ªå®šä¹‰æ´»åŠ¨åŠ è½½å®Œæˆ.åŠ¨ä½œæ•°: ${actLength}`)}activityDictAdd(){for(const a in this.activityToAddDict){const pendingActivity=this.activityToAddDict[a],actName=pendingActivity.act.Name,nameWithoutPrefix=Localization.get("Activity",actName.substring(6)),actTarget=pendingActivity.act.Target,actTargetSelf=pendingActivity.act.TargetSelf,addedValues=[];if(addedValues.push([`ActivityAct_${actName}`,`${nameWithoutPrefix}`]),addedValues.push([`Activity${actName}`,`${nameWithoutPrefix}`]),actTarget.length>0)for(let i=0;i<actTarget.length;i++){const aT=actTarget[i];addedValues.push([`Label-ChatOther-${aT}-${actName}`,`${nameWithoutPrefix}${pendingActivity.isBase?Localization.get("Activity",aT):""}`]),addedValues.push([`ChatOther-${aT}-${actName}`,this.getStr(`${nameWithoutPrefix}.Desc.0`,"SourceCharacter","TargetCharacter",Localization.get("Activity",aT))])}if(void 0!==actTargetSelf&&"boolean"!=typeof actTargetSelf&&actTargetSelf.length>0)for(const aTS of actTargetSelf)addedValues.push([`Label-ChatSelf-${aTS}-${actName}`,`${nameWithoutPrefix}${pendingActivity.isBase?Localization.get("Activity",aTS):""}`]),addedValues.push([`ChatSelf-${aTS}-${actName}`,this.getStr(`${nameWithoutPrefix}.Desc.1`,"SourceCharacter","TargetCharacter",Localization.get("Activity",aTS))]);pendingActivity.desc=addedValues}}pushToActivity(activity){ActivityFemale3DCG.push(activity),ActivityFemale3DCGOrdering.push(activity.Name)}getAllAct(){const result=[];for(const a in this.activityToAddDict){const suffix=this.getActName(a).substring(6);result.push(suffix)}return conDebug({content:result,name:"ActivityNameXiaosu_onlyName",type:MSGType.DebugLog}),result}getActName(act){try{return this.activityToAddDict[`${act}`].act.Name}catch(error){throw conDebug({content:`${act}`,name:"getActName",type:MSGType.DebugLog},!0),error}}}class ChatroomModule extends BaseModule{constructor(){super(...arguments),this.moan=[]}Load(){this.hookListHandler(),this.pathListHandler(),this.Loaded=!0}Init(){window.AddChatRightClickEvent||(window.AddChatRightClickEvent=this.AddChatRightClickEvent),document.addEventListener("click",(()=>{ChatroomModule.HideContextmenu()})),this.priority=30,ChatroomModule.contextmenuText=[Localization.get("Chatroom","Contextmenu.Button.reply"),Localization.get("Chatroom","Contextmenu.Button.whisper"),Localization.get("Chatroom","Contextmenu.Button.copy"),Localization.get("Chatroom","Contextmenu.Button.delete")];for(let i=0;i<=9;i++)this.moan.push(Localization.get("Chatroom",`moan.${i}`));for(let i=0;i<=7;i++)ChatroomModule.kaomojiSet.help.push(Localization.get("Chatroom",`kaomojiHelp.${i}`))}hookListHandler(){hookFunction("ChatRoomLoad",this.priority,((args,next)=>{const result=next(args);return ChatroomModule.InputElement||(ChatroomModule.InputElement=document.getElementById("InputChat")),ChatroomModule.buildKaomojiButton(),result})),hookFunction("ElementPosition",this.priority,((args,next)=>{const result=next(args);return"InputChat"===args[0]&&ChatroomModule.ResizeKaomojiButton(),result})),hookFunction("ElementCreateTextArea",this.priority,((args,next)=>{const result=next(args);return"InputChat"===args[0]&&(ChatroomModule.InputElement=document.getElementById("InputChat")),result})),hookFunction("ChatRoomClearAllElements",this.priority,((args,next)=>(ChatroomModule.removeKaomojiMenu(),ChatroomModule.InputElement=null,next(args)))),hookFunction("ChatRoomShowElements",this.priority,((args,next)=>{const result=next(args);return ChatroomModule.showKaomojiMenu(),result})),hookFunction("ChatRoomHideElements",this.priority,((args,next)=>{const result=next(args);return ChatroomModule.hideKaomojiMenu(),result})),hookFunction("ChatRoomCurrentTime",99,(()=>{const D=new Date,hStr=`0${D.getHours()}`,mStr=`0${D.getMinutes()}`,sStr=`0${D.getSeconds()}`;return`${hStr.substring(hStr.length-2)}:${mStr.substring(mStr.length-2)}:${sStr.substring(sStr.length-2)}`})),hookFunction("CommandParse",0,((args,next)=>{let msg=args[0];const match=msg.match(/^`([1-9])?(m)?( )? (.*)/);match&&(msg="m"!=match[2]?this.stammerHandler(match[4],parseInt(match[1]),!0,!1):this.stammerHandler(match[4],parseInt(match[1]),!0,!0));const kaomojiMatch=msg.match(/^\|(.*)/);if(!kaomojiMatch)return args[0]=msg,next(args);if(Object.keys(ChatroomModule.kaomojiSet).includes(kaomojiMatch[1])||"all"==kaomojiMatch[1]){ChatroomModule.kaomojiHandler(kaomojiMatch[1]);document.getElementById("InputChat").value=""}else{ChatRoomSendLocal(Localization.get("Chatroom","kaomoji.doesNotExist.tips"),5e3);document.getElementById("InputChat").value="|"}})),hookFunction("ChatRoomMessageDisplay",10,((args,next)=>{const msg=args[1],matchWord=Localization.get("Chatroom","Prefix.reply");if("string"==typeof msg&&msg.startsWith(`ğŸª§${matchWord}*>`)){const match=msg.match(new RegExp(`^ğŸª§(${matchWord}*>.+<*)s(.+)`));match&&(args[1]=match[2],ChatRoomSendLocal(`--ğŸª§--${match[1]}--ğŸª§--`))}next(args)}))}pathListHandler(){var functionName,patches;functionName="ChatRoomMessageDisplay",patches={"div.innerHTML = displayMessage;":"\n            if (!!window.AddChatRightClickEvent) window.AddChatRightClickEvent(div);\n            div.innerHTML = displayMessage;\n            "},bcModSDK.patchFunction(functionName,patches)}AddChatRightClickEvent(div){const divClassName=div.className;(divClassName.includes("ChatMessageChat")||divClassName.includes("ChatMessageEmote"))&&div.addEventListener("contextmenu",(function(event){event.preventDefault(),ChatroomModule.showContextmenu(event)}))}static showContextmenu(e){const div=e.target;div&&(this.targetDiv=div,this.Contextmenu?(this.Contextmenu.style.display="flex",ChatroomModule.changeContextmenuPosition(e)):ChatroomModule.buildNewContextmenu(e))}static HideContextmenu(){this.Contextmenu&&(this.Contextmenu.style.display="none")}static buildNewContextmenu(e){const contextmenu=document.createElement("div");contextmenu.className="xsa-contextmenu",contextmenu.style.display="none",this.Contextmenu=contextmenu,ChatroomModule.changeContextmenuPosition(e);for(let i=0;i<4;i++){const contextmenuItem=document.createElement("div");contextmenuItem.className="xsa-contextmenu-item",contextmenuItem.innerText=ChatroomModule.contextmenuText[i];const replyPrefix=Localization.get("Chatroom","Prefix.reply");contextmenuItem.addEventListener("click",(()=>{switch(i){case 0:ElementValue("InputChat",`ğŸª§${replyPrefix}*>${ChatroomModule.targetDiv?.textContent}<*\n${ElementValue("InputChat")}`),ElementFocus("InputChat");break;case 1:navigator.clipboard.writeText(ChatroomModule.targetDiv?.textContent??"");break;case 2:{const target=ChatroomModule.targetDiv?.getAttribute("data-sender"),targetNum=parseInt(target??"0");if(Number.isNaN(targetNum)||targetNum===Player.MemberNumber)return;ChatRoomSetTarget(targetNum),ChatRoomTarget(),ElementFocus("InputChat");break}case 3:ChatroomModule.targetDiv?.remove()}})),contextmenu.appendChild(contextmenuItem)}contextmenu.style.display="flex",document.body.appendChild(contextmenu)}static changeContextmenuPosition(e){if(!this.Contextmenu)return;let left=e.clientX;left+.06*window.screen.width>window.screen.width&&(left=e.clientX-.06*window.screen.width);let top=e.clientY;top+.06*window.screen.height>window.screen.height&&(top=e.clientY-.06*window.screen.height),this.Contextmenu.style.left=`${left}px`,this.Contextmenu.style.top=`${top}px`}ExportChat(time_limit=null){const exportName=`${ChatRoomData?.Name}_${(new Date).toLocaleString()}`;copyAndDownloadHtmlElement(document.getElementById("TextAreaChatLog"),exportName,time_limit)}stammerHandler(content,tenfoldStammeringProbability,isSegmentForCH,haveMoan){conDebug(`stammerHandler: content: ${content} tenfoldStammeringProbability: ${tenfoldStammeringProbability}`),Number.isNaN(tenfoldStammeringProbability)&&(tenfoldStammeringProbability=3);const stammeringProbability=tenfoldStammeringProbability/10,segmentList=isSegmentForCH?this.segmentForCH("CN"===TranslationLanguage?content.replace(/\s/g,""):content):void 0,stringArray=segmentList||content.split(" ");return this.stammerForList(stringArray,stammeringProbability,haveMoan)}segmentForCH(str){if(window.Intl&&window.Intl.Segmenter){const segmenterResult=new Intl.Segmenter(Localization.get("Other",TranslationLanguage.toLowerCase()),{granularity:"word"}).segment(str),results=[];for(const segment of segmenterResult)results.push(segment.segment);return conDebug(`segmentForCH: ${results}`),results}return null}stammerForList(messageList,stammeringProbability,haveMoan){let result="";for(let i=0;i<messageList.length;i++){const currentWord=messageList[i];result+=currentWord,Math.random()<stammeringProbability&&(result+=this.addStammerEffect(currentWord)),haveMoan&&Player.ArousalSettings?.Progress&&100*Math.random()<=Player.ArousalSettings?.Progress&&(result+=this.moan[Math.floor(Math.random()*this.moan.length)]),i<messageList.length-1?Math.random()<stammeringProbability&&(result+="-"):result+="..."}return conDebug({name:"stammer",type:MSGType.DebugLog,content:result}),result}addStammerEffect(word,depth=0){if(depth>=3)return word;let result=Math.random()<.5?"...":`-${word}`;return Math.random()<.2&&(result=this.addStammerEffect(result,depth+1)),result}static kaomojiHandler(message){this.getKaomojiMenu(message).style.display="flex",this.KaomojiShouldShow=!0}static buildKaomojiButton(){if(this.KaomojiButton)return this.KaomojiButton;const button=document.createElement("button");return button.id="kaomoji-button",button.className="kaomoji-button",button.type="button",button.addEventListener("click",(()=>{this.KaomojiMenuObject.menu&&"none"!==this.KaomojiMenuObject.menu.style.display?"none"!==this.KaomojiMenuObject.menu.style.display&&(this.KaomojiMenuObject.menu.style.display="none",this.KaomojiShouldShow=!1):this.kaomojiHandler("all")})),this.isKaomojiMenuCloseEventListenerAdded||(document.addEventListener("click",(event=>{const target=event.target;!target.closest("#kaomoji-menu")&&!target.closest("#kaomoji-button")&&this.KaomojiMenuObject.menu&&this.KaomojiShouldShow&&(this.KaomojiMenuObject.menu.style.display="none",this.KaomojiShouldShow=!1)})),this.isKaomojiMenuCloseEventListenerAdded=!0),button.innerHTML=":)",this.ResizeKaomojiButton(),this.KaomojiButton=button,document.body.appendChild(button),button}static ResizeKaomojiButton(){this.InputElement&&this.KaomojiButton&&(this.KaomojiButton.style.top=parseInt(this.InputElement.style.top)-.026*window.innerHeight+"px",this.KaomojiButton.style.left=parseInt(this.InputElement.style.left)-.026*window.innerHeight+"px")}static getKaomojiMenu(key){const{kaomojiContainer:kaomojiContainer,menu:menu}=this.KaomojiMenuObject.menu?{kaomojiContainer:this.KaomojiMenuObject.container,menu:this.KaomojiMenuObject.menu}:ChatroomModule.buildKaomojiMenu();return this.selectKaomojiTitle(kaomojiContainer,key),menu}static kaomojiClick(event,kaomojiElement){if(0===event.button){if(this.InputElement){const cursorPosition=this.InputElement.selectionStart;if(null===cursorPosition||-1==cursorPosition)this.InputElement.value+=kaomojiElement.textContent;else{const value=this.InputElement.value,newValue=value.substring(0,cursorPosition)+kaomojiElement.textContent+value.substring(cursorPosition);this.InputElement.value=newValue;const newCursorPosition=cursorPosition+(null==kaomojiElement.textContent?0:kaomojiElement.textContent.length);this.InputElement.setSelectionRange(newCursorPosition,newCursorPosition)}}}else 2===event.button?null!=(msg=kaomojiElement.textContent)&&ServerSend("ChatRoomChat",{Content:msg,Type:"Emote"}):1===event.button&&function(msg){null!=msg&&ServerSend("ChatRoomChat",{Type:"Chat",Content:msg})}(kaomojiElement.textContent);var msg}static buildKaomojiMenu(){const menu=document.createElement("div");menu.id="kaomoji-menu",menu.style.display="flex";const menuTitle=document.createElement("div"),menuTitleTextSet=this.menuTitleTextSet,menuTitleClose=document.createElement("button");menuTitleClose.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"\n            viewBox="0 0 24 24">\n            <circle cx="12" cy="12" r="10" fill="red" />\n        </svg>';const kaomojiContainer=document.createElement("div");menu.appendChild(menuTitle),menu.appendChild(kaomojiContainer),menu.className="kaomoji-menu",menuTitle.className="kaomoji-title",menuTitleClose.className="kaomoji-title-close",kaomojiContainer.className="kaomoji-container",menuTitleClose.addEventListener("click",(()=>{menu.style.display="none",this.KaomojiShouldShow=!1}));for(const key in menuTitleTextSet)menuTitleTextSet[key].innerHTML=Localization.get("Chatroom",`KaomojiTitle.${key}`),menuTitleTextSet[key].className="kaomoji-title-text",menuTitle.appendChild(menuTitleTextSet[key]),menuTitleTextSet[key].addEventListener("click",(()=>{this.selectKaomojiTitle(kaomojiContainer,key)}));return menuTitle.appendChild(menuTitleClose),this.KaomojiMenuObject={title:menuTitle,container:kaomojiContainer,menu:menu},document.body.appendChild(menu),{kaomojiContainer:kaomojiContainer,menu:menu}}static selectMenuTitleStyleHandle(selectKey){this.menuTitleTextSet[selectKey].classList.contains("kaomoji-title-text-active")||this.menuTitleTextSet[selectKey].classList.add("kaomoji-title-text-active");for(const key2 in this.menuTitleTextSet)key2!=selectKey&&this.menuTitleTextSet[key2].classList.remove("kaomoji-title-text-active")}static selectKaomojiTitle(kaomojiContainer,key){const kaomojiList="all"==key?this.getAllKaomoji():this.kaomojiSet[key];kaomojiContainer.innerHTML="";this.selectMenuTitleStyleHandle(key);for(const kaomoji of kaomojiList){const kaomojiElement=document.createElement("div");kaomojiElement.className="kaomoji",kaomojiElement.innerText=kaomoji,"help"!==key&&(kaomojiElement.addEventListener("click",(event=>{this.kaomojiClick(event,kaomojiElement)})),kaomojiElement.addEventListener("contextmenu",(event=>{event.preventDefault(),this.kaomojiClick(event,kaomojiElement)})),kaomojiElement.addEventListener("mousedown",(event=>{1===event.button&&(event.preventDefault(),this.kaomojiClick(event,kaomojiElement))}))),kaomojiContainer.appendChild(kaomojiElement)}}static removeKaomojiMenu(){this.KaomojiButton&&(this.KaomojiButton.remove(),this.KaomojiButton=null),this.KaomojiMenuObject.menu&&(this.KaomojiMenuObject.menu.remove(),this.KaomojiMenuObject={menu:null,title:null,container:null})}static hideKaomojiMenu(){this.KaomojiMenuObject.menu&&(this.KaomojiMenuObject.menu.style.display="none"),this.KaomojiButton&&(this.KaomojiButton.style.display="none")}static showKaomojiMenu(){this.KaomojiMenuObject.menu&&1==this.KaomojiShouldShow&&(this.KaomojiMenuObject.menu.style.display="flex"),this.KaomojiButton&&(this.KaomojiButton.style.display="inline")}static getAllKaomoji(){const allKaomojiList=[];for(const key in this.kaomojiSet)if("help"!=key)for(const kaomoji of this.kaomojiSet[key])allKaomojiList.push(kaomoji);return allKaomojiList}}ChatroomModule.InputElement=null,ChatroomModule.Contextmenu=null,ChatroomModule.targetDiv=null,ChatroomModule.KaomojiMenuObject={menu:null,title:null,container:null},ChatroomModule.menuTitleTextSet={all:document.createElement("div"),hp:document.createElement("div"),sd:document.createElement("div"),sy:document.createElement("div"),ar:document.createElement("div"),ap:document.createElement("div"),cf:document.createElement("div"),nt:document.createElement("div")},ChatroomModule.KaomojiButton=null,ChatroomModule.KaomojiShouldShow=!1,ChatroomModule.kaomojiSet={help:[],hp:["ãƒ¾(â€â•¹â—¡â•¹)ï¾‰~"," (à¹‘>Ø‚<à¹‘ï¼‰","(ï½¡ï½¥Ï‰ï½¥ï½¡)ï¾‰â™¡","(â— Â´ê’³` â—)","(ï¿£wï¿£)ãƒ","Hi~ o(*ï¿£â–½ï¿£*)ãƒ–","(â‰§âˆ‡â‰¦)ï¾‰","o(^â–½^)o","(ï¿£ï¸¶ï¿£)â†—","<(ï¿£ï¸¶ï¿£)â†—[GO!]","o(*ï¿£â–½ï¿£*)o","(pâ‰§wâ‰¦q)","ã„Ÿ(â‰§â—‡â‰¦)ã„","(/â‰§â–½â‰¦)/","(ã€€ï¾Ÿâˆ€ï¾Ÿ) ï¾‰â™¡","(â—'â—¡'â—)","ãƒ½(âœ¿ï¾Ÿâ–½ï¾Ÿ)ãƒ","o(*ï¿£ï¸¶ï¿£*)o","(à¹‘Â¯âˆ€Â¯à¹‘)","(â‰§âˆ€â‰¦)ã‚","Ï†(â‰§Ï‰â‰¦*)â™ª","â•°(*Â°â–½Â°*)â•¯","(*^â–½^*)","(à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§","(à©­*ËŠáµ•Ë‹)à©­*à¬˜*","(oã‚œâ–½ã‚œ)oâ˜†[BINGO!]","(^â–½^ )","<(*ï¿£â–½ï¿£*)/","â”Œ|*Â´âˆ€ï½€|â”˜","â™ª(Â´âˆ‡`*)","(ï½¡â—•à¸ºË‡Îµ Ë‡â—•à¸ºï½¡ï¼‰"," âœŒï¸( á› )âœŒï¸","(*ãƒ»Ï‰ãƒ»)ï¾‰","(â€â€¢ ÖŠ â€¢â€)"],sd:["ãƒ†_ãƒ‡","â–¡_â–¡","â”­â”®ï¹â”­â”®","â•¥ï¹â•¥...","o(Tãƒ˜To)","ã€’â–½ã€’","Îµ(â”¬â”¬ï¹â”¬â”¬)3","(;Â´à¼àº¶Ğ”à¼àº¶`)","(ãƒã¸`ã€)","ï¼ˆ-_-ã€‚ï¼‰","(ãƒã¸ï¿£ã€)","ï½¡â—”â€¸â—”ï½¡","(âŠ™ï¹âŠ™)"],sy:["|Ï‰ãƒ»ï¼‰","|ï½¥Ï‰ï½¥ï½€)","â—•à¸ºâ€¿â—•à¸ºâœ¿à¸º)","ã¤ï¹âŠ‚","(* /Ï‰ï¼¼*)","o(*////â–½////*)q","(*/Ï‰ï¼¼*)","(â€²â–½`ã€ƒ)","(âœ¿â—¡â€¿â—¡)","(/â–½ï¼¼)","(à¹‘Â´ã…‚`à¹‘)","(â—¡á´—â—¡âœ¿)","â„(â„ â„â€¢â„Ï‰â„â€¢â„ â„)â„","(ã€ƒ'â–½'ã€ƒ)","(à¹‘â•¹ãƒ®â•¹à¹‘)ï¾‰"],ar:["/á ï½¡êˆï½¡áŸ\\","ËƒÊË‚","(Ïƒï½€Ğ´â€²)Ïƒ","ï¼¼(ã‚œãƒ­ï¼¼)(ï¼ãƒ­ã‚œ)ï¼","<(ï¼ï¸¿ï¼)>","(ãƒ¼`Â´ãƒ¼)","ï¼ˆï½€ã¸Â´ï¼‰","(-__-)=@))> o<)","(///ï¿£çš¿ï¿£)â—‹ï½","â”»â”â”»ï¸µâ•°(â€µâ–¡â€²)â•¯ï¸µâ”»â”â”»","â†’)â•¥ï¹â•¥)","æŠ½!!(ï¿£Îµ(#ï¿£)â˜†â•°â•®(ï¿£â–½ï¿£///)","(ï¿£Îµ(#ï¿£)â˜†â•°â•®o(ï¿£çš¿ï¿£///)","(* ï¿£ï¸¿ï¿£)","ï¼ˆï¼ƒï¿£ï½ï¿£ï¼ƒï¼‰","(âŠ™xâŠ™;)","o(*â‰§â–½â‰¦)ãƒ„â”â”â”“","(ãƒÏ‰<ã€‚)ãƒ))â˜†.ã€‚","(ã€ƒï¼ç›®ï¼œ)","( Ïƒ'Ï‰')Ïƒ","o(â€²ç›Š`)o","(ã€ƒï¼ç›®ï¼œ)","o(â‰§å£â‰¦)o","ï¼¯(â‰§å£â‰¦)ï¼¯","...(*ï¿£ï¼ï¿£)ãƒ[ç­‰ç­‰æˆ‘â€¦]","ï¼ˆâ‰§0â‰¦ï¼‰","Ïˆ(*ï½€ãƒ¼Â´)Ïˆ","Ïˆ(ï¿£çš¿ï¿£)ãƒ"],sp:["âœ§âˆ‡âœ§","!!!âˆ‘(ï¾ŸĞ”ï¾Ÿãƒ)ãƒ","â€™(Â°ãƒ¼Â°ã€ƒ)","ãƒ¾(ãƒ' ï¹ƒ' )ãƒ","(ãƒ¼ãƒ¼ã‚›)","(â—‹Â´ï½¥Ğ´ï½¥)ï¾‰","wow~ âŠ™oâŠ™","~(ï¿£0ï¿£)/","Î£(ï½€Ğ´â€²*ãƒ)ãƒ","Î£(ã£ Â°Ğ” Â°;)ã£","(âŠ™ËâŠ™)","w(ï¾ŸĞ”ï¾Ÿ)w","ï½(oãƒ»Ï‰ãƒ»o)ï½","âŠ™â–½âŠ™","ï¼ˆà®‡à¯°à®‡ï¼‰","(â—Â°uÂ°â—)â€‹ ã€","ï¼ˆï½¡Ã² âˆ€ Ã³ï½¡ï¼‰","(à¹‘â€¢Ì€Ï‰â€¢Ì)ãƒ"],cf:["âš†_âš†","( -'`-)","(=â€²ãƒ¼`)","( -'`-; )","(ãƒ»-ãƒ»*)","( ï½€Ğ´â€²)","(ï¿£mï¿£ï¼‰","( â•¯â–½â•°)"," o-o(=â€¢ã‚§â€¢=)m","(âŠ™ï¹âŠ™)","Î£( Â° â–³ Â°|||)ï¸´","(âŠ™ËâŠ™)","( á—œ Ë° á—œ )","ê’° Ë¶â€¢ à¼ â€¢Ë¶ê’±"],nt:["(Ë‰â–½ï¿£ï½) åˆ‡~~","(ï¿£wï¿£)ãƒ","(ï¿£vï¿£)ãƒ","(ï¿£lï¿£)ãƒ","( ï¿£ãƒ¼ï¿£)","(â€¾â—¡â—)","(ï¿£_,ï¿£ )","( ï¹ ï¹ ) ~â†’","<(ï¿£ ï¹Œ ï¿£)@m","ê‰‚-ê‰‚(ËŠá—œË‹*)","(ï½€ãƒ»Ï‰ãƒ»Â´ï¼‰","à¼¼ ã¤ â—•_â—• à¼½ã¤","ãƒ½(âœ¿ï¾Ÿâ–½ï¾Ÿ)ãƒ (Â°ãƒ¼Â°ã€ƒ)","ãƒ¾(ï¿£â–½ï¿£)Bye~Bye~","(â—‰Ï‰â—‰Ï…)â¼Â³â‚Œâ‚ƒ","(â—â€”â—)","(ï½¡ï½¥âˆ€ï½¥)ï¾‰ï¾","â”¬â”€â”¬ ãƒ('-'ãƒ)","â”¸â”â”â”¸)>å£<)","(-.-)..zzZZ","(ï½¡â—á´—â—œï½¡)"," =ÍÍŸÍŸÍ(ê’ªá—œê’ª â€§Ì£Ì¥Ì‡)","(ËµÂ¯Í’ã€°Â¯Í’Ëµ)"]},ChatroomModule.isKaomojiMenuCloseEventListenerAdded=!1;class ChessModule extends BaseModule{Load(){hookFunction("ChatRoomMessage",10,((args,next)=>{const data=args[0];if("object"!=typeof data||"XSA_Chess"!==data.Content||!data.Dictionary)return next(args);{const CheckerInfo=data.Dictionary[0];if(CheckerInfo.sender===Player.MemberNumber)return;this.ShowChessboard(CheckerInfo,data.Sender??0)}})),this.Loaded=!0}Init(){this.priority=0}static getChessDivKey(p1,p2){const combinedString=`${p1}${p2}`;let hash=0;for(let i=0;i<combinedString.length;i++){hash=(hash<<5)-hash+combinedString.charCodeAt(i),hash|=0}return hash}SendAChess(Player1,Player2,Round,checkerboard=Chess.newCheckerboard,started=!1){const CheckerInfo={Player1:Player1,Player2:Player2,Round:Round,Checkerboard:checkerboard,start:started,sender:Player.MemberNumber??-1};ServerSend("ChatRoomChat",{Type:"Hidden",Content:"XSA_Chess",Dictionary:[CheckerInfo],Sender:Player.MemberNumber})}ShowChessboard(info,sender){const chess=new Chess(info.Player1);chess.LoadInfo(info);const div=document.createElement("div"),chessKey=ChessModule.getChessDivKey(chess.player1MemberNumber,chess.player2MemberNumber??-1);ChessModule.ChessDivMap.has(chessKey)?(ChessModule.ChessDivMap.get(chessKey).remove(),ChessModule.ChessDivMap.delete(chessKey),ChessModule.ChessDivMap.set(chessKey,div)):ChessModule.ChessDivMap.set(chessKey,div),div.setAttribute("class","ChatMessage ChatMessageLocalMessage"),div.setAttribute("data-time",ChatRoomCurrentTime()),div.setAttribute("data-sender",sender);const main=chess.Element;if(!info.start||chess.player1MemberNumber===Player.MemberNumber||chess.player2MemberNumber===Player.MemberNumber){const sendButton=document.createElement("button");sendButton.className="ChatMessageButton",sendButton.innerHTML=Localization.get("Chess","button.send"),sendButton.addEventListener("click",(()=>{chess.Disable=!0,info.start&&info.Player1===Player.MemberNumber&&chess.Round++,info.start||info.Player1===Player.MemberNumber||(chess.player2MemberNumber=Player.MemberNumber??null,info.start=!0),this.SendAChess(chess.player1MemberNumber,chess.player2MemberNumber,chess.Round,chess.checkerboard,info.start),sendButton.remove(),setTimeout((()=>{div.remove()}),3e4)})),main.appendChild(sendButton)}div.appendChild(main),ChatRoomAppendChat(div)}}ChessModule.ChessDivMap=new Map;class Chess{constructor(player1MemberNumber){this.player1MemberNumber=player1MemberNumber,this.player1Name=this.getPlayer1Name(),this.canChange1=!1,this.player2MemberNumber=null,this.player2Name=Localization.get("Chess","not_started_identification"),this.canChange2=!1,this.checkerboard=Chess.newCheckerboard,this.Round=0,this.Disable=!1}LoadInfo(info){this.player2MemberNumber=info.Player2,this.player2Name=this.getPlayer2Name(),this.player1MemberNumber===Player.MemberNumber?(this.canChange1=!0,this.canChange2=!1):this.player2MemberNumber&&this.player2MemberNumber!==Player.MemberNumber||(this.canChange1=!1,this.canChange2=!0),this.Round=info.Round,this.checkerboard=info.Checkerboard}getPlayer1(){return ChatRoomCharacter.find((c=>c.MemberNumber==this.player1MemberNumber))??null}getPlayer1Name(){const P1=this.getPlayer1();return P1?""!==P1.Nickname&&P1.Nickname?P1.Nickname:P1.Name:Localization.get("Chess","lost_identification")}getPlayer2(){return null===this.player2MemberNumber?null:ChatRoomCharacter.find((c=>c.MemberNumber==this.player2MemberNumber))??null}getPlayer2Name(){const P2=this.getPlayer2();return null===this.player2MemberNumber?Localization.get("Chess","not_started_identification"):P2?""!==P2.Nickname&&P2.Nickname?P2.Nickname:P2.Name:Localization.get("Chess","lost_identification")}static get newCheckerboard(){const result=[];for(let r=1;r<=19;r++){const _row=[];for(let c=1;c<=19;c++)_row.push(null);result.push(_row)}return result}get Element(){const main=document.createElement("div");main.className="chessContainer";const title=document.createElement("div");title.className="chessTitle";const playerSymbol=Localization.get("Chess","symbol.player");title.innerHTML=`|---${playerSymbol}1: ${this.player1Name} ğŸ†š ${playerSymbol}2: ${this.player2Name}---|---${Localization.get("Chess","symbol.round")}: ${this.Round}---|`,main.appendChild(title);const checkerboard=document.createElement("table");checkerboard.className="chessTable";let rowIndex=0,colIndex=0;for(const row of this.checkerboard){rowIndex++,colIndex=0;const tableRow=document.createElement("tr");for(const i of row){colIndex++;const call=document.createElement("td");call.className="chessCell",call.setAttribute("row",rowIndex.toString()),call.setAttribute("col",colIndex.toString()),call.setAttribute("value",0),!0===i?call.setAttribute("value",1):!1===i&&call.setAttribute("value",2),call.addEventListener("click",(()=>{this.chessCallClick(call)})),this.updateChessCallColor(call),tableRow.appendChild(call)}checkerboard.appendChild(tableRow)}return main.appendChild(checkerboard),main}chessCallClick(call){if(this.Disable)return;const callValue=call.getAttribute("value");this.canChange1&&("0"===callValue&&call.setAttribute("value",1),"1"===callValue&&call.setAttribute("value",0)),this.canChange2&&("0"===callValue&&call.setAttribute("value",2),"2"===callValue&&call.setAttribute("value",0)),this.updateChessCallColor(call),this.changeCheckerboard(parseInt(call.getAttribute("row")),parseInt(call.getAttribute("col")),parseInt(call.getAttribute("value")))}updateChessCallColor(call){switch(call.getAttribute("value")){case"0":call.className="chessCell";break;case"1":call.className="chessCell chessCellWhite";break;case"2":call.className="chessCell chessCellBlack"}}changeCheckerboard(rowIndex,colIndex,value){switch(value){case 0:this.checkerboard[rowIndex-1][colIndex-1]=null;break;case 1:this.checkerboard[rowIndex-1][colIndex-1]=!0;break;case 2:this.checkerboard[rowIndex-1][colIndex-1]=!1}}}const timeRangeRegex=/^((0|1)\d|2[0-3]):[0-5]\d(:[0-5]\d)?-((0|1)\d|2[0-3]):[0-5]\d(:[0-5]\d)?$/;class CommandsModule extends BaseModule{constructor(){super(...arguments),this.commandsDict={help:{Tag:"help",Description:Localization.get("Command","desc.help"),Action:(_args,_msg,_parsed)=>{this.DisplayHelp()}},export:{Tag:"export",Description:Localization.get("Command","desc.export"),Action:(_args,_msg,parsed)=>{const params=this.getCommandParameters(parsed);if("h"==params)ChatRoomSendLocal(Localization.get("Command","help.export"),2e4);else if(""===params)conDebug("å¯¼å‡ºå½“å‰èŠå¤©å®¤çš„å…¨éƒ¨èŠå¤©è®°å½•"),GetModule("ChatroomModule").ExportChat();else if(timeRangeRegex.test(params)){conDebug(`å¯¼å‡ºæŒ‡å®šçš„ ${params} æ—¶é—´æ®µçš„èŠå¤©è®°å½•`);const separatorIndex=params.indexOf("-");if(-1!==separatorIndex){const time_limit={minTime:params.slice(0,separatorIndex).trim(),maxTime:params.slice(separatorIndex+1).trim()};GetModule("ChatroomModule").ExportChat(time_limit)}}}},v:{Tag:"v",Description:Localization.get("Command","desc.v"),Action:(_args,_msg,_parsed)=>{!function(){let content="";for(const c in CHANGELOG){const version=CHANGELOG[c].version,type=CHANGELOG[c].type==ChangeType.main?"ä¸»ç‰ˆæœ¬":"å¼€å‘ç‰ˆæœ¬",description=CHANGELOG[c].description,changes=CHANGELOG[c].changes;let changesString='<ul style="list-style-position: inside;  padding-left: 0;">';for(const s of changes)changesString+=`<li>${s}</li>`;changesString+="</ul>";const styleForP='style="font-weight: bold; margin: 0;"';content+=`<div style="background-color: ${version!=XSActivity_VERSION||DEBUG||"ä¸»ç‰ˆæœ¬"!==type?"#442E3A":"#764460"}; display: flex; flex-direction: column;"> <p ${styleForP}>ç‰ˆæœ¬: ${version}</p> <p ${styleForP}>ç±»å‹: ${type}</p> <p ${styleForP}>æè¿°: ${description}</p><p>----</p> <p ${styleForP}>æ”¹åŠ¨: ${changesString}</p><p>========</p></div>`}content+="<p>==å½“å‰é¡µé¢æ˜¾ç¤ºæ—¶é—´1åˆ†é’Ÿ==</p>",ChatRoomSendLocal(content,6e4)}()}},new:{Tag:"new",Description:Localization.get("Command","desc.new"),Action:(_args,_msg,_parsed)=>{sendLastChangeLog()}},act:{Tag:"act",Description:Localization.get("Command","desc.act"),Action:(_args,_msg,_parsed)=>{let content="";GetModule("ActivityModule").getAllAct().forEach((item=>{content+=`<p style="font-weight: bold; margin: 0;">${item}</p>`})),conDebug(`command: AL    content: ${content}`),ChatRoomSendLocal(content,2e4)}},jieba:{Tag:"jieba",Description:Localization.get("Command","desc.jieba"),Action:(_args,_msg,_parsed)=>{ChatRoomSendLocal(Localization.get("Command","help.jieba","style='word-wrap: break-word;list-style: square;color: #FFCEE9;background-color: #AB6B8E;border-radius: 3px;padding: .2em .6em;margin: .2em .6em;'","style='word-wrap: break-word;list-style: square;color: #B0809B;background-color: #AB6B8E;border-radius: 3px;padding: .2em .6em;margin: .2em .6em;'"))}},kaomoji:{Tag:"kaomoji",Description:Localization.get("Command","desc.kaomoji"),Action:()=>{ChatRoomSendLocal(Localization.get("Command","help.kaomoji","style='word-wrap: break-word;list-style: square;color: #FFCEE9;background-color: #AB6B8E;border-radius: 3px;padding: .2em .6em;margin: .2em .6em;'","style='word-wrap: break-word;list-style: square;color: #B0809B;background-color: #AB6B8E;border-radius: 3px;padding: .2em .6em;margin: .2em .6em;'"))}},chess:{Tag:"chess",Description:Localization.get("Command","desc.chess"),Action:(args,msg,parsed)=>{const params=this.getCommandParameters(parsed);""===params?GetModule("ChessModule").ShowChessboard({Player1:Player.MemberNumber??-1,Player2:null,Round:0,Checkerboard:Chess.newCheckerboard,start:!1,sender:Player.MemberNumber??-1},Player.MemberNumber??-1):"h"===params&&SendLocalMessage(Localization.get("Command","help.chess"))}}}}Load(){CommandCombine({Tag:"xsa",Description:Localization.get("Command","desc.mainCommand"),Action:(args,msg,parsed)=>{parsed.length>0?this.CommandHandler(parsed):this.DisplayHelp()},AutoComplete:(parsed,low,msg)=>{let word="";const commandsList=[];for(const c in this.commandsDict)commandsList.push(c);const foundCommands=[];if(commandsList.forEach((c=>{c.startsWith(parsed[0])&&foundCommands.push(c)})),1===foundCommands.length&&(word=foundCommands[0],parsed.length>1&&ChatRoomSendLocal(`${this.commandsDict[word].Description}`,3e3)),foundCommands.length>1){let content="";for(const c of foundCommands)content+=`/xsa ${c} ${this.commandsDict[c].Description}\n`;content+=`${Localization.get("Command","desc.version")}: ${XSActivity_VERSION}\n`,ChatRoomSendLocal(content,3e3)}""!==word&&ElementValue("InputChat",CommandsKey+"xsa "+word),ElementFocus("InputChat")}}),this.Loaded=!0}Init(){this.priority=20}getCommandParameters(parsed){const lastParam=parsed[parsed.length-1];return lastParam.startsWith("-")?lastParam.slice(1):""}DisplayHelp(msg){if(void 0===msg){let content="";for(const c in this.commandsDict)content+=`/xsa ${c} ${this.commandsDict[c].Description}\n`;content+=`${Localization.get("Command","desc.version")}: ${XSActivity_VERSION}\n`,ChatRoomSendLocal(content,1e4)}else ChatRoomSendLocal(msg,1e4)}CommandHandler(parsed){const parsedCount=parsed.length;if(0==parsedCount&&this.DisplayHelp(),parsedCount>=1){const last=parsed[parsedCount-1];if(last.startsWith("-")){const cmd=parsed[parsedCount-2];cmd in this.commandsDict&&this.commandsDict[cmd]?.Action?.("","",parsed)}else last in this.commandsDict&&this.commandsDict[last]?.Action?.("","",parsed)}}}var _a$1;const PlayerStorage=()=>Player.XSA,PlayerOnlineSharedSettingsStorage=()=>Player.OnlineSharedSettings?.XSA,ExtensionStorage=()=>Player.ExtensionSettings.XSA,XSA_OnlineSharedSettingsDataKeyList=["wombTattoosAppliedEffects","sensitiveLevel"];class DataModule extends BaseModule{Load(){_a$1.allDataTake(),this.hookListHandle(),_a$1.SyncDataForPlayer(),this.hookListHandle(),this.Loaded=!0}Init(){this.priority=99,window.BROWSER_NAME=_a$1.browserName,window.BROWSER_VERSION=_a$1.browserVersion;const linkElement=document.createElement("link");linkElement.rel="stylesheet",linkElement.type="text/css",linkElement.href=CSShref,document.head.appendChild(linkElement)}hookListHandle(){hookFunction("ChatRoomLeave",this.priority,((args,next)=>(_a$1.allDataSave(),setTimeout((()=>{ActivityChatRoomArousalSync(Player)}),1e3),next(args)))),hookFunction("ChatRoomSync",this.priority,((args,next)=>{switch(_a$1.allDataSave(),_a$1.IsModUpDate){case 0:break;case 1:setTimeout((()=>{sendLastChangeLog()}),2e3),_a$1.IsModUpDate=0;break;case-1:setTimeout((()=>{SendLocalMessage(Localization.get("Data","TIPS_FOR_LOADING_OLDER_VERSIONS"))}),2e3),_a$1.IsModUpDate=0}return next(args)}))}static allDataTake(){if(ExtensionStorage()){Player.XSA=JSON.parse(LZString.decompressFromBase64(ExtensionStorage())??"");const afterVersion=Player.XSA.version;if(afterVersion!==XSActivity_VERSION){const versionCompare=this.CompareVersions(afterVersion,XSActivity_VERSION);this.IsModUpDate=versionCompare,Player.XSA.version=XSActivity_VERSION}for(const k2 in Player.XSA.data)void 0===Player.XSA.data[k2]&&(Player.XSA.data[k2]=this.DefaultData[k2]);for(const k3 in Player.XSA.settings)void 0===Player.XSA.settings[k3]&&(Player.XSA.settings[k3]=this.DefaultSetting[k3])}else Player.XSA={version:XSActivity_VERSION,data:this.DefaultData,settings:this.DefaultSetting},this.IsModUpDate=1;PlayerOnlineSharedSettingsStorage()?Player.OnlineSharedSettings.XSA={wombTattoosAppliedEffects:Player.XSA.data.wombTattoosAppliedEffects??[],sensitiveLevel:Player.XSA.data.sensitiveLevel??0}:Player.OnlineSharedSettings.XSA=this.DefaultOnlineSharedSettingsData}static allDataSave(){ExtensionStorage()||(Player.ExtensionSettings.XSA="");const data={version:PlayerStorage()?.version??XSActivity_VERSION,settings:PlayerStorage()?.settings??{},data:PlayerStorage()?.data??{}};Player.ExtensionSettings.XSA=LZString.compressToBase64(JSON.stringify(data)),ServerPlayerExtensionSettingsSync("XSA")}static SaveSettings(settingsItem){const settingsData=PlayerStorage()?.settings;for(const item in settingsItem)settingsData&&settingsData[item]!=settingsItem[item]&&(settingsData[item]=settingsItem[item])}static SaveData(dataItem){const data=PlayerStorage()?.data,OnlineSharedSettings=PlayerOnlineSharedSettingsStorage();for(const itemKey in dataItem)data&&data[itemKey]!=dataItem[itemKey]&&(data[itemKey]=dataItem[itemKey]),OnlineSharedSettings&&XSA_OnlineSharedSettingsDataKeyList.includes(itemKey)&&(OnlineSharedSettings[itemKey]=dataItem[itemKey])}static SyncDataForPlayer(){const data=PlayerStorage()?.data;data&&(Player.ArousalSettings&&Player.ArousalSettings.Progress&&data.player_Progress&&(Player.ArousalSettings.Progress=data.player_Progress),ActivityOrgasmGameResistCount=data.resistCount??0)}static CompareVersions(oldVersion,newVersion){const parseVersion=version=>version.replace("v","").split(".").map((part=>{const parsed=parseInt(part,10);return isNaN(parsed)?0:parsed})),oldVersionArray=parseVersion(oldVersion),newVersionArray=parseVersion(newVersion),maxLength=Math.max(oldVersionArray.length,newVersionArray.length);for(let i=0;i<maxLength;i++){const oldPart=oldVersionArray[i]??0,newPart=newVersionArray[i]??0;if(oldPart<newPart)return 1;if(oldPart>newPart)return-1}return 1}}_a$1=DataModule,DataModule.userAgentString=navigator.userAgent,DataModule.browserVersionRegex=/(chrome|firefox|safari|opera|edge|msie|trident(?=\/))\/?\s*(\d+)/i,DataModule.match=_a$1.userAgentString.match(_a$1.browserVersionRegex),DataModule.DefaultData={haveWombTattoos:!1,wombTattoosAppliedEffects:[],sensitiveLevel:0,resistCount:0,player_Progress:0},DataModule.DefaultSetting={},DataModule.DefaultOnlineSharedSettingsData={wombTattoosAppliedEffects:[],sensitiveLevel:0},DataModule.browserName=_a$1.match?_a$1.match[1]:"unknown",DataModule.browserVersion=_a$1.match?parseInt(_a$1.match[2]):-1,DataModule.IsModUpDate=0;class DrawModule extends BaseModule{Load(){hookFunction("DrawProcessScreenFlash",-999,((args,next)=>(DrawModule.DrawFlash(),next(args)))),hookFunction("Player.GetBlurLevel",-999,((args,next)=>{let blurLevel=next(args);return CommonPhotoMode||0!==blurLevel||0===DrawModule.blurLevel||(blurLevel=DrawModule.blurLevel),blurLevel})),this.Loaded=!0}Init(){this.priority=20}static setFlash(color,time,intensity,callback){this.DrawFlashEventMap.set(Symbol(),{color:color,time:time,intensity:intensity,evenEnd:!1,callback:callback})}static DrawFlash(){if("ChatRoom"===CurrentScreen||0!==this.DrawFlashEventMap.size)for(const[key,event]of this.DrawFlashEventMap.entries()){if(event.evenEnd){this.DrawFlashEventMap.delete(key);continue}const commonTime=CommonTime();if(this.FlashEndTime=this.FlashEndTime??event.time+commonTime,this.FlashEndTime>commonTime){const FlashAlpha=this.DrawGetFlashAlpha(this.FlashEndTime-commonTime,event.intensity);DrawRect(0,0,2e3,1e3,event.color+FlashAlpha);break}event.evenEnd=!0,this.FlashEndTime=null,event.callback?.()}}static setDrawBlur(duration,level){this.blurLevel=level,setTimeout((()=>{this.blurLevel=0}),duration)}static DrawGetFlashAlpha(flashTime,flashIntensity){let alpha=Math.max(0,Math.min(255,Math.floor(flashIntensity*(1-Math.exp(-flashTime/2500))))).toString(16);return alpha.length<2&&(alpha="0"+alpha),alpha}static calculateDynamicIntensity(elapsedTime,baseIntensity,totalDuration){const phase=2*Math.PI*elapsedTime/500;return baseIntensity+.1*baseIntensity*Math.sin(phase)}}DrawModule.blurLevel=0,DrawModule.DrawFlashEventMap=new Map,DrawModule.FlashEndTime=null;class TimerProcessInjector extends BaseModule{static set setProcessInjectionSequence(sequence){for(const c of sequence)this.processInjectionSet[c.name]=c}Load(){TimerProcessInjector.ProcessInjection(),this.Loaded=!0}Init(){this.priority=999}static ProcessInjection(){this.InjectionSort();for(const c of this.processInjectionSequence)"number"==typeof c.timeInterval?this.TimerLastCycleCallSet[c.name]={timerLastCycleCall:-1,timeInterval:c.timeInterval,isDynamic:!1}:this.TimerLastCycleCallSet[c.name]={timerLastCycleCall:-1,timeInterval:c.timeInterval(),isDynamic:!0,getTimeInterval:c.timeInterval};conDebug(`[TimerProcessInjector] Injection Process... Injection Count: ${this.processInjectionSequence.length}`),hookFunction("TimerProcess",100,((args,next)=>{if("ChatRoom"!==CurrentScreen)return next(args);const currentTime=CommonTime();for(const c of this.processInjectionSequence)-1==this.TimerLastCycleCallSet[c.name].timerLastCycleCall&&this.TimerLastCycleCallSet[c.name].timerLastCycleCall,c.preconditions()&&this.TimerLastCycleCallSet[c.name].timerLastCycleCall+this.TimerLastCycleCallSet[c.name].timeInterval<=currentTime&&(c.code(),this.TimerLastCycleCallSet[c.name].timerLastCycleCall=currentTime,this.TimerLastCycleCallSet[c.name].isDynamic&&(this.TimerLastCycleCallSet[c.name].timeInterval=this.TimerLastCycleCallSet[c.name].getTimeInterval()));return next(args)}))}static InjectionSort(){this.processInjectionSequence=Object.values(this.processInjectionSet).sort(((a,b)=>a.priority-b.priority))}}var _a;TimerProcessInjector.processInjectionSequence=[],TimerProcessInjector.processInjectionSet={},TimerProcessInjector.TimerLastCycleCallSet={};class ModuleLoader{static InitModules(){return this.generateModule(),void 0!==this.mList&&this.mList.sort(((a,b)=>a.priority-b.priority)).forEach((m=>{m.Init(),conDebug(`æ¨¡å— ${m.moduleName} å°è¯•åˆå§‹åŒ–å®Œæˆ`),this.modulesInitCount++})),this.modulesInitCount}static LoadModules(){return void 0!==this.mList&&this.mList.forEach((m=>{m.Load(),conDebug(`æ¨¡å— ${m.moduleName} å·²å°è¯•åŠ è½½`),this.modulesLoadCount++})),this.CheckModulesLoaded()?(this.CompleteLoadingSuccessful=!0,window.XSActivity_Loaded=!0):(this.CompleteLoadingSuccessful=!1,window.XSActivity_Loaded=!1),this.modulesLoadCount}static CheckModulesLoaded(){if(7!=this.modulesLoadCount||this.modulesInitCount!=this.modulesLoadCount)return conDebug(`æ¨¡å—åŠ è½½å¤±è´¥ï¼Œæ¨¡å—æ•°é‡ä¸åŒ¹é…ï¼Œåˆå§‹åŒ–æ•°é‡ä¸º${this.modulesInitCount}æ¨¡å—åŠ è½½æ•°é‡ä¸º${this.modulesLoadCount}ï¼Œåº”ä¸º7`),!1;if(void 0===_a.mList)return conDebug("æ¨¡å—åŠ è½½å¤±è´¥ï¼Œæ¨¡å—åˆ—è¡¨æœªåˆå§‹åŒ–"),!1;for(const m of _a.mList)if(!m.Loaded)return conDebug(`æ¨¡å—åŠ è½½å¤±è´¥ï¼Œæ¨¡å— ${m.moduleName} æœªåŠ è½½å®Œæˆ`),!1;return conDebug("æ¨¡å—åŠ è½½å®Œæˆ"),!0}static pushToModules(module){this.modules[module.moduleName]=module,void 0!==this.mList?this.mList.push(module):this.mList=[module]}static generateModule(){let generateModuleCount=0;for(const mN in _a.ModuleMap)"Base"!==mN&&void 0===this.modules[mN]&&(_a.ModuleMap[mN](),generateModuleCount++);return generateModuleCount}}function init(){if(window.XSActivity_Loaded)return;const InitModuleCount=ModuleLoader.InitModules();conDebug({type:MSGType.Workflow_Log,name:"XSActivity Initialized!",content:`Init ${InitModuleCount} modules `});const moduleCount=ModuleLoader.LoadModules();if(conDebug({type:MSGType.Workflow_Log,name:"XSActivity Loaded!",content:`Loaded ${moduleCount} modules    FullLoaded: ${ModuleLoader.CompleteLoadingSuccessful}`}),!ModuleLoader.CompleteLoadingSuccessful)throw new Error("XSActivity load or init failed")}return _a=ModuleLoader,ModuleLoader.modules=MODULES,ModuleLoader.modulesLoadCount=0,ModuleLoader.modulesInitCount=0,ModuleLoader.CompleteLoadingSuccessful=!1,ModuleLoader.ModuleMap={Base:()=>{throw new Error("Baseä¸ºæ¨¡å—çš„æŠ½è±¡ç±»ï¼Œè¯·å‹¿åŠ è½½")},TimerProcessInjector:()=>{_a.pushToModules(new TimerProcessInjector("TimerProcessInjector"))},ActivityModule:()=>{_a.pushToModules(new ActivityModule("ActivityModule"))},ChatroomModule:()=>{_a.pushToModules(new ChatroomModule("ChatroomModule"))},CommandsModule:()=>{_a.pushToModules(new CommandsModule("CommandsModule"))},DataModule:()=>{_a.pushToModules(new DataModule("DataModule"))},DrawModule:()=>{_a.pushToModules(new DrawModule("DrawModule"))},ChessModule:()=>{_a.pushToModules(new ChessModule("ChessModule"))}},Localization.init(),conDebug({name:"Start Init",type:MSGType.Workflow_Log,content:"Init wait"}),null!=CurrentScreen&&"Login"!==CurrentScreen||(hookFunction("LoginResponse",999,((args,next)=>{const response=args[0];if(response&&"string"==typeof response.Name&&"string"==typeof response.AccountName)for(const group of AssetFemale3DCG)if("ClothAccessory"===group.Group){for(const item of group.Asset)if("WombTattoos"===item.Name){item.BodyCosplay=!1;break}break}return next(args)})),hookFunction("LoginResponse",10,((args,next)=>{const result=next(args);conDebug({name:"Init! Login Response caught",content:args,type:MSGType.Workflow_Log});const response=args[0];return(response&&"string"==typeof response.Name&&"string"==typeof response.AccountName||!ModuleLoader.CompleteLoadingSuccessful)&&init(),result}))),exports.init=init,exports}({});
//# sourceMappingURL=XSActivity.js.map
